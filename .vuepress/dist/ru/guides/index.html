<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Руководства | Vue Test Utils</title>
    <meta name="description" content="Библиотека для тестирования Vue-компонентов">
    <link rel="icon" href="/favicon.png">
    
    <link rel="preload" href="/assets/css/0.styles.6fddc57d.css" as="style"><link rel="preload" href="/assets/js/app.1329aa21.js" as="script"><link rel="preload" href="/assets/js/189.0798f541.js" as="script"><link rel="prefetch" href="/assets/js/10.29680c27.js"><link rel="prefetch" href="/assets/js/100.04f6aa34.js"><link rel="prefetch" href="/assets/js/101.0faed46e.js"><link rel="prefetch" href="/assets/js/102.5adbd4f8.js"><link rel="prefetch" href="/assets/js/103.ab03605d.js"><link rel="prefetch" href="/assets/js/104.853529ed.js"><link rel="prefetch" href="/assets/js/105.894916b1.js"><link rel="prefetch" href="/assets/js/106.15048092.js"><link rel="prefetch" href="/assets/js/107.75338401.js"><link rel="prefetch" href="/assets/js/108.380e49c8.js"><link rel="prefetch" href="/assets/js/109.eff80191.js"><link rel="prefetch" href="/assets/js/11.48ee5d3b.js"><link rel="prefetch" href="/assets/js/110.c8a76652.js"><link rel="prefetch" href="/assets/js/111.5ea0f65d.js"><link rel="prefetch" href="/assets/js/112.4ad98b3d.js"><link rel="prefetch" href="/assets/js/113.ecaf59db.js"><link rel="prefetch" href="/assets/js/114.d0f18bce.js"><link rel="prefetch" href="/assets/js/115.325a0839.js"><link rel="prefetch" href="/assets/js/116.3ad73770.js"><link rel="prefetch" href="/assets/js/117.4e280aa7.js"><link rel="prefetch" href="/assets/js/118.b4efe52b.js"><link rel="prefetch" href="/assets/js/119.9ab9e340.js"><link rel="prefetch" href="/assets/js/12.38da1e11.js"><link rel="prefetch" href="/assets/js/120.e2fb2daa.js"><link rel="prefetch" href="/assets/js/121.6f844508.js"><link rel="prefetch" href="/assets/js/122.ff2feb8e.js"><link rel="prefetch" href="/assets/js/123.9654b63b.js"><link rel="prefetch" href="/assets/js/124.8058bc12.js"><link rel="prefetch" href="/assets/js/125.15ac88b0.js"><link rel="prefetch" href="/assets/js/126.4919d1ce.js"><link rel="prefetch" href="/assets/js/127.ba415b0c.js"><link rel="prefetch" href="/assets/js/128.3b5a1f15.js"><link rel="prefetch" href="/assets/js/129.08fff316.js"><link rel="prefetch" href="/assets/js/13.2467e4d3.js"><link rel="prefetch" href="/assets/js/130.6177b120.js"><link rel="prefetch" href="/assets/js/131.3662683e.js"><link rel="prefetch" href="/assets/js/132.0a99c1ca.js"><link rel="prefetch" href="/assets/js/133.57ac58f3.js"><link rel="prefetch" href="/assets/js/134.68205139.js"><link rel="prefetch" href="/assets/js/135.62d0a716.js"><link rel="prefetch" href="/assets/js/136.1ba9fe2b.js"><link rel="prefetch" href="/assets/js/137.c002612a.js"><link rel="prefetch" href="/assets/js/138.104f9872.js"><link rel="prefetch" href="/assets/js/139.9937ea4d.js"><link rel="prefetch" href="/assets/js/14.09d9e43c.js"><link rel="prefetch" href="/assets/js/140.fc69423e.js"><link rel="prefetch" href="/assets/js/141.4278b1d2.js"><link rel="prefetch" href="/assets/js/142.02f17f28.js"><link rel="prefetch" href="/assets/js/143.edc98244.js"><link rel="prefetch" href="/assets/js/144.84ff6903.js"><link rel="prefetch" href="/assets/js/145.c4300d0b.js"><link rel="prefetch" href="/assets/js/146.97b8c42b.js"><link rel="prefetch" href="/assets/js/147.b45db334.js"><link rel="prefetch" href="/assets/js/148.29cc9dac.js"><link rel="prefetch" href="/assets/js/149.20083aaa.js"><link rel="prefetch" href="/assets/js/15.768aa9d0.js"><link rel="prefetch" href="/assets/js/150.5ffb1fda.js"><link rel="prefetch" href="/assets/js/151.0ef482d4.js"><link rel="prefetch" href="/assets/js/152.a7b342f2.js"><link rel="prefetch" href="/assets/js/153.d66cadd0.js"><link rel="prefetch" href="/assets/js/154.cf1b0ac0.js"><link rel="prefetch" href="/assets/js/155.17b5e561.js"><link rel="prefetch" href="/assets/js/156.baf08bf3.js"><link rel="prefetch" href="/assets/js/157.d4ada28a.js"><link rel="prefetch" href="/assets/js/158.ebb753a6.js"><link rel="prefetch" href="/assets/js/159.91678ded.js"><link rel="prefetch" href="/assets/js/16.5bdeee2c.js"><link rel="prefetch" href="/assets/js/160.acc3bfd8.js"><link rel="prefetch" href="/assets/js/161.b80960b6.js"><link rel="prefetch" href="/assets/js/162.5309d0c0.js"><link rel="prefetch" href="/assets/js/163.1f1af0fa.js"><link rel="prefetch" href="/assets/js/164.9aa31800.js"><link rel="prefetch" href="/assets/js/165.67089a2d.js"><link rel="prefetch" href="/assets/js/166.e4381a59.js"><link rel="prefetch" href="/assets/js/167.e061b4be.js"><link rel="prefetch" href="/assets/js/168.1622ee8d.js"><link rel="prefetch" href="/assets/js/169.a74fa5ec.js"><link rel="prefetch" href="/assets/js/17.6a9184c3.js"><link rel="prefetch" href="/assets/js/170.dbcbf8ff.js"><link rel="prefetch" href="/assets/js/171.a3b8a4f9.js"><link rel="prefetch" href="/assets/js/172.de198904.js"><link rel="prefetch" href="/assets/js/173.3fd7eba4.js"><link rel="prefetch" href="/assets/js/174.125158bf.js"><link rel="prefetch" href="/assets/js/175.5773a31e.js"><link rel="prefetch" href="/assets/js/176.fcbaf7d1.js"><link rel="prefetch" href="/assets/js/177.e13c54ed.js"><link rel="prefetch" href="/assets/js/178.461c97de.js"><link rel="prefetch" href="/assets/js/179.18556f26.js"><link rel="prefetch" href="/assets/js/18.4739f596.js"><link rel="prefetch" href="/assets/js/180.d8162130.js"><link rel="prefetch" href="/assets/js/181.3e030696.js"><link rel="prefetch" href="/assets/js/182.0d333584.js"><link rel="prefetch" href="/assets/js/183.2c46f0c1.js"><link rel="prefetch" href="/assets/js/184.59f17e66.js"><link rel="prefetch" href="/assets/js/185.7925ce4a.js"><link rel="prefetch" href="/assets/js/186.3acf0daf.js"><link rel="prefetch" href="/assets/js/187.96e6dcdd.js"><link rel="prefetch" href="/assets/js/188.8cf3b309.js"><link rel="prefetch" href="/assets/js/19.30d0c826.js"><link rel="prefetch" href="/assets/js/190.66cb08eb.js"><link rel="prefetch" href="/assets/js/191.452d56c4.js"><link rel="prefetch" href="/assets/js/192.65b42183.js"><link rel="prefetch" href="/assets/js/193.702243fe.js"><link rel="prefetch" href="/assets/js/194.cc073482.js"><link rel="prefetch" href="/assets/js/195.48a7245e.js"><link rel="prefetch" href="/assets/js/196.feae8953.js"><link rel="prefetch" href="/assets/js/197.70d94a78.js"><link rel="prefetch" href="/assets/js/198.99f9b3d3.js"><link rel="prefetch" href="/assets/js/199.d88b8456.js"><link rel="prefetch" href="/assets/js/20.8c56e86c.js"><link rel="prefetch" href="/assets/js/200.80ba7b94.js"><link rel="prefetch" href="/assets/js/201.aad9c773.js"><link rel="prefetch" href="/assets/js/202.3402b8a7.js"><link rel="prefetch" href="/assets/js/203.8a011962.js"><link rel="prefetch" href="/assets/js/204.db458acf.js"><link rel="prefetch" href="/assets/js/205.f88837dd.js"><link rel="prefetch" href="/assets/js/206.97b6ee18.js"><link rel="prefetch" href="/assets/js/207.2175c20a.js"><link rel="prefetch" href="/assets/js/208.4d4fc400.js"><link rel="prefetch" href="/assets/js/209.2b8f6d9c.js"><link rel="prefetch" href="/assets/js/21.b1fca836.js"><link rel="prefetch" href="/assets/js/210.9fbe7e4f.js"><link rel="prefetch" href="/assets/js/211.b9d49f94.js"><link rel="prefetch" href="/assets/js/212.03bddb3f.js"><link rel="prefetch" href="/assets/js/213.ce98d5fc.js"><link rel="prefetch" href="/assets/js/214.dc7073f3.js"><link rel="prefetch" href="/assets/js/215.2afd5e1e.js"><link rel="prefetch" href="/assets/js/216.544b7ade.js"><link rel="prefetch" href="/assets/js/217.b067af8d.js"><link rel="prefetch" href="/assets/js/218.377bede2.js"><link rel="prefetch" href="/assets/js/219.27f6f18c.js"><link rel="prefetch" href="/assets/js/22.092854f5.js"><link rel="prefetch" href="/assets/js/220.68ba890e.js"><link rel="prefetch" href="/assets/js/221.ff994cf8.js"><link rel="prefetch" href="/assets/js/222.3c530c59.js"><link rel="prefetch" href="/assets/js/223.543c93de.js"><link rel="prefetch" href="/assets/js/224.134c6c7a.js"><link rel="prefetch" href="/assets/js/225.674555de.js"><link rel="prefetch" href="/assets/js/226.fec2925b.js"><link rel="prefetch" href="/assets/js/227.10c8d245.js"><link rel="prefetch" href="/assets/js/228.fd07045c.js"><link rel="prefetch" href="/assets/js/229.c0feb073.js"><link rel="prefetch" href="/assets/js/23.d845f6d8.js"><link rel="prefetch" href="/assets/js/230.2e0a02ff.js"><link rel="prefetch" href="/assets/js/231.3a77efd5.js"><link rel="prefetch" href="/assets/js/232.b5bbcb42.js"><link rel="prefetch" href="/assets/js/233.cc853042.js"><link rel="prefetch" href="/assets/js/234.757ff651.js"><link rel="prefetch" href="/assets/js/235.660cc45c.js"><link rel="prefetch" href="/assets/js/236.98ccd76a.js"><link rel="prefetch" href="/assets/js/237.b04def99.js"><link rel="prefetch" href="/assets/js/238.b4d318e6.js"><link rel="prefetch" href="/assets/js/239.449c536e.js"><link rel="prefetch" href="/assets/js/24.a1fa948d.js"><link rel="prefetch" href="/assets/js/240.57ff4221.js"><link rel="prefetch" href="/assets/js/241.1bd6a846.js"><link rel="prefetch" href="/assets/js/242.d95c91dc.js"><link rel="prefetch" href="/assets/js/243.1e6f8aac.js"><link rel="prefetch" href="/assets/js/244.2c4a8646.js"><link rel="prefetch" href="/assets/js/245.afaa20c3.js"><link rel="prefetch" href="/assets/js/246.16616268.js"><link rel="prefetch" href="/assets/js/247.3406b39c.js"><link rel="prefetch" href="/assets/js/248.165a9d74.js"><link rel="prefetch" href="/assets/js/249.1e4e5921.js"><link rel="prefetch" href="/assets/js/25.b335f886.js"><link rel="prefetch" href="/assets/js/250.0a4a23a1.js"><link rel="prefetch" href="/assets/js/251.6e59411b.js"><link rel="prefetch" href="/assets/js/252.f77513bf.js"><link rel="prefetch" href="/assets/js/253.dc28afed.js"><link rel="prefetch" href="/assets/js/254.5765c3f9.js"><link rel="prefetch" href="/assets/js/255.6808c117.js"><link rel="prefetch" href="/assets/js/256.16f7d2c3.js"><link rel="prefetch" href="/assets/js/257.68e09d25.js"><link rel="prefetch" href="/assets/js/258.f03f1c22.js"><link rel="prefetch" href="/assets/js/259.62ed35af.js"><link rel="prefetch" href="/assets/js/26.0b12b1d4.js"><link rel="prefetch" href="/assets/js/260.ef39b24c.js"><link rel="prefetch" href="/assets/js/261.71e6f0db.js"><link rel="prefetch" href="/assets/js/262.bf234e8c.js"><link rel="prefetch" href="/assets/js/263.e3630155.js"><link rel="prefetch" href="/assets/js/264.04e2bcb8.js"><link rel="prefetch" href="/assets/js/265.6f4e18ce.js"><link rel="prefetch" href="/assets/js/266.aeb06326.js"><link rel="prefetch" href="/assets/js/27.bbed2698.js"><link rel="prefetch" href="/assets/js/28.b7b0808e.js"><link rel="prefetch" href="/assets/js/29.8643a805.js"><link rel="prefetch" href="/assets/js/3.ba802fc9.js"><link rel="prefetch" href="/assets/js/30.bb145cc6.js"><link rel="prefetch" href="/assets/js/31.b82c119c.js"><link rel="prefetch" href="/assets/js/32.3ebc8ac8.js"><link rel="prefetch" href="/assets/js/33.5a4570f6.js"><link rel="prefetch" href="/assets/js/34.a2c4b2ad.js"><link rel="prefetch" href="/assets/js/35.e424a17b.js"><link rel="prefetch" href="/assets/js/36.bcf7d6d3.js"><link rel="prefetch" href="/assets/js/37.87610ef6.js"><link rel="prefetch" href="/assets/js/38.63a687c1.js"><link rel="prefetch" href="/assets/js/39.6fe142e4.js"><link rel="prefetch" href="/assets/js/4.1e032f20.js"><link rel="prefetch" href="/assets/js/40.b931ff87.js"><link rel="prefetch" href="/assets/js/41.94fdb234.js"><link rel="prefetch" href="/assets/js/42.85378732.js"><link rel="prefetch" href="/assets/js/43.13a9295c.js"><link rel="prefetch" href="/assets/js/44.3228b04d.js"><link rel="prefetch" href="/assets/js/45.66a222b7.js"><link rel="prefetch" href="/assets/js/46.0c596ee2.js"><link rel="prefetch" href="/assets/js/47.50770cc8.js"><link rel="prefetch" href="/assets/js/48.56dce17d.js"><link rel="prefetch" href="/assets/js/49.a76a2cbb.js"><link rel="prefetch" href="/assets/js/5.68d5f562.js"><link rel="prefetch" href="/assets/js/50.11b83e09.js"><link rel="prefetch" href="/assets/js/51.b52ef253.js"><link rel="prefetch" href="/assets/js/52.032204ec.js"><link rel="prefetch" href="/assets/js/53.83cc7c06.js"><link rel="prefetch" href="/assets/js/54.0405a748.js"><link rel="prefetch" href="/assets/js/55.6b40fabe.js"><link rel="prefetch" href="/assets/js/56.6d6eeae4.js"><link rel="prefetch" href="/assets/js/57.27a5e368.js"><link rel="prefetch" href="/assets/js/58.7b7fc153.js"><link rel="prefetch" href="/assets/js/59.4fc050dd.js"><link rel="prefetch" href="/assets/js/6.628b9f9a.js"><link rel="prefetch" href="/assets/js/60.64dab6ba.js"><link rel="prefetch" href="/assets/js/61.fb115e71.js"><link rel="prefetch" href="/assets/js/62.19be661f.js"><link rel="prefetch" href="/assets/js/63.b50bec8c.js"><link rel="prefetch" href="/assets/js/64.4abe7d11.js"><link rel="prefetch" href="/assets/js/65.727de1b7.js"><link rel="prefetch" href="/assets/js/66.6500f2d0.js"><link rel="prefetch" href="/assets/js/67.4911332d.js"><link rel="prefetch" href="/assets/js/68.e7d2b80e.js"><link rel="prefetch" href="/assets/js/69.8b364c08.js"><link rel="prefetch" href="/assets/js/7.2381a9a5.js"><link rel="prefetch" href="/assets/js/70.bf129352.js"><link rel="prefetch" href="/assets/js/71.d62c85bf.js"><link rel="prefetch" href="/assets/js/72.685c7c67.js"><link rel="prefetch" href="/assets/js/73.bd9225b9.js"><link rel="prefetch" href="/assets/js/74.d0e63c75.js"><link rel="prefetch" href="/assets/js/75.ac1516c8.js"><link rel="prefetch" href="/assets/js/76.a76672e2.js"><link rel="prefetch" href="/assets/js/77.7fa90e9a.js"><link rel="prefetch" href="/assets/js/78.b27852cd.js"><link rel="prefetch" href="/assets/js/79.9964f1bb.js"><link rel="prefetch" href="/assets/js/8.a0f2028d.js"><link rel="prefetch" href="/assets/js/80.e831bc7f.js"><link rel="prefetch" href="/assets/js/81.f4adc35d.js"><link rel="prefetch" href="/assets/js/82.79dc5f2d.js"><link rel="prefetch" href="/assets/js/83.a42f5133.js"><link rel="prefetch" href="/assets/js/84.8c6c443a.js"><link rel="prefetch" href="/assets/js/85.c036fe47.js"><link rel="prefetch" href="/assets/js/86.253e8f74.js"><link rel="prefetch" href="/assets/js/87.4765a9dc.js"><link rel="prefetch" href="/assets/js/88.fd60117d.js"><link rel="prefetch" href="/assets/js/89.6a7b741f.js"><link rel="prefetch" href="/assets/js/9.18ef8d1c.js"><link rel="prefetch" href="/assets/js/90.5df03d9e.js"><link rel="prefetch" href="/assets/js/91.edc99526.js"><link rel="prefetch" href="/assets/js/92.a9aaf7f6.js"><link rel="prefetch" href="/assets/js/93.b5488e19.js"><link rel="prefetch" href="/assets/js/94.90c0b724.js"><link rel="prefetch" href="/assets/js/95.96685ca5.js"><link rel="prefetch" href="/assets/js/96.dfd1b877.js"><link rel="prefetch" href="/assets/js/97.4312b650.js"><link rel="prefetch" href="/assets/js/98.6b7e7ac0.js"><link rel="prefetch" href="/assets/js/99.c1f5db36.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.4cd972f0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6fddc57d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/ru/" class="home-link router-link-active"><!----> <span class="site-name">Vue Test Utils</span></a> <div class="links" style="max-width:nullpx;"><form id="search-form" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/ru/api/" class="nav-link">API</a></div><div class="nav-item"><a href="/ru/guides/" class="nav-link router-link-exact-active router-link-active">Руководства</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Переводы</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guides/" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/ja/guides/" class="nav-link">日本語</a></li><li class="dropdown-item"><!----> <a href="/zh/guides/" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/ru/guides/" class="nav-link router-link-exact-active router-link-active">Русский</a></li></ul></div></div> <a href="https://github.com/vuejs/vue-test-utils" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/ru/api/" class="nav-link">API</a></div><div class="nav-item"><a href="/ru/guides/" class="nav-link router-link-exact-active router-link-active">Руководства</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Переводы</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guides/" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/ja/guides/" class="nav-link">日本語</a></li><li class="dropdown-item"><!----> <a href="/zh/guides/" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/ru/guides/" class="nav-link router-link-exact-active router-link-active">Русский</a></li></ul></div></div> <a href="https://github.com/vuejs/vue-test-utils" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav> <div class="carbon-ads"></div> <ul class="sidebar-links"><li><a href="/ru/" class="sidebar-link">Введение</a></li><li><a href="/ru/guides/" class="active sidebar-link">Руководства</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ru/guides/#введение" class="sidebar-link">Введение</a></li><li class="sidebar-sub-header"><a href="/ru/guides/#общие-советы" class="sidebar-link">Общие советы</a></li><li class="sidebar-sub-header"><a href="/ru/guides/#тестирование-нажатий-кnавиш-мыши-и-других-событий-dom" class="sidebar-link">Тестирование нажатий клавиш, мыши и других событий DOM</a></li><li class="sidebar-sub-header"><a href="/ru/guides/#чем-запускать-тесты" class="sidebar-link">Чем запускать тесты</a></li><li class="sidebar-sub-header"><a href="/ru/guides/#тестирование-однофайnовых-компонентов-с-jest" class="sidebar-link">Тестирование однофайловых компонентов с Jest</a></li><li class="sidebar-sub-header"><a href="/ru/guides/#тестирование-однофайnовых-компонентов-с-mocha-и-webpack" class="sidebar-link">Тестирование однофайловых компонентов с Mocha и webpack</a></li><li class="sidebar-sub-header"><a href="/ru/guides/#тестирование-однофайnовых-компонентов-с-karma" class="sidebar-link">Тестирование однофайловых компонентов с Karma</a></li><li class="sidebar-sub-header"><a href="/ru/guides/#тестирование-асинхронной-nогики" class="sidebar-link">Тестирование асинхронной логики</a></li><li class="sidebar-sub-header"><a href="/ru/guides/#using-with-typescript" class="sidebar-link">Using with TypeScript</a></li><li class="sidebar-sub-header"><a href="/ru/guides/#испоnьзование-с-vue-router" class="sidebar-link">Использование с Vue Router</a></li><li class="sidebar-sub-header"><a href="/ru/guides/#тестирование-vuex-в-компонентах" class="sidebar-link">Тестирование Vuex в компонентах</a></li></ul></li><li><a href="/ru/api/" class="sidebar-link">API</a></li><li><a href="/ru/api/wrapper/" class="sidebar-link">Wrapper</a></li><li><a href="/ru/api/wrapper-array/" class="sidebar-link">WrapperArray</a></li><li><a href="/ru/api/options.html" class="sidebar-link">Опции монтирования</a></li><li><a href="/ru/api/components/" class="sidebar-link">Компоненты</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="руководства"><a href="#руководства" class="header-anchor">#</a> Руководства</h1> <h2 id="введение"><a href="#введение" class="header-anchor">#</a> Введение</h2> <h3 id="настройка"><a href="#настройка" class="header-anchor">#</a> Настройка</h3> <p>Для быстрого старта работы с Vue Test Utils, клонируйте наш демонстрационный репозиторий с базовыми настройками и установите зависимости:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> clone https://github.com/vuejs/vue-test-utils-getting-started
<span class="token builtin class-name">cd</span> vue-test-utils-getting-started
<span class="token function">npm</span> <span class="token function">install</span>
</code></pre></div><p>Вы увидите, что проект содержит простой компонент <code>counter.js</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// counter.js</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  template<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;div&gt;
      &lt;span class=&quot;count&quot;&gt;{{ count }}&lt;/span&gt;
      &lt;button @click=&quot;increment&quot;&gt;Increment&lt;/button&gt;
    &lt;/div&gt;
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>

  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      count<span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">++</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="монтирование-компонентов"><a href="#монтирование-компонентов" class="header-anchor">#</a> Монтирование компонентов</h3> <p>Vue Test Utils тестирует компоненты Vue монтируя их изолированно, создавая моки необходимых входных данных (входные параметры, инъекции и пользовательские события) и выполняя проверки над результатом (результат рендеринга, вызванные пользовательские события).</p> <p>Примонтированные компоненты возвращаются внутри <a href="/ru/api/wrapper/">Wrapper</a>, который предоставляет множество удобных методов для манипулирования, перемещения и различных запросов для экземпляра компонента Vue.</p> <p>Вы можете создавать wrapper с помощью метода <code>mount</code>. Давайте создадим файл <code>test.js</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// test.js</span>

<span class="token comment">// Импортируем метод `mount()` из `vue-test-utils`</span>
<span class="token comment">// и компонент, который хотим протестировать</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">'./counter'</span>

<span class="token comment">// Теперь монтируем компонент и у нас появляется wrapper</span>
<span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span>

<span class="token comment">// Вы можете получить доступ к экземпляру Vue через `wrapper.vm`</span>
<span class="token keyword">const</span> vm <span class="token operator">=</span> wrapper<span class="token punctuation">.</span>vm

<span class="token comment">// Чтобы изучить wrapper подробнее, просто выведите его в консоль</span>
<span class="token comment">// и ваши приключения с `vue-test-utils` начнутся</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span>
</code></pre></div><h3 id="тестирование-отрендеренного-html-компонента"><a href="#тестирование-отрендеренного-html-компонента" class="header-anchor">#</a> Тестирование отрендеренного HTML компонента</h3> <p>Теперь, когда у нас есть wrapper, первой вещью, которую мы можем захотеть проверить что отрендеренный HTML компонента соответствует нашим ожиданиям.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">'./counter'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Компонент Counter'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Теперь монтируем компонент и получаем wrapper</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'отображает корректную разметку'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">'&lt;span class=&quot;count&quot;&gt;0&lt;/span&gt;'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// также легко проверить наличие других элементов</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'имеет кнопку'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Теперь запустите тесты командой <code>npm test</code>. Вы должны увидеть, что все тесты проходят успешно.</p> <h3 id="симуnяция-поnьзоватеnьских-действий"><a href="#симуnяция-поnьзоватеnьских-действий" class="header-anchor">#</a> Симуляция пользовательских действий</h3> <p>Наш счётчик должен увеличивать значение, когда пользователь нажимает кнопку. Чтобы симулировать это поведение, нам необходимо сначала получить кнопку с помощью <code>wrapper.find()</code>, который возвращает <strong>wrapper для элемента кнопки</strong>. Мы можем симулировать клик с помощью вызова <code>.trigger()</code> на wrapper кнопки:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'нажатие кнопки должно увеличивать счётчик'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> button <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span>
  button<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="что-деnать-с-nexttick"><a href="#что-деnать-с-nexttick" class="header-anchor">#</a> Что делать с <code>nextTick</code>?</h3> <p>Vue собирает пачку предстоящих обновлений DOM и применяет их асинхронно для избежания ненужных повторных рендерингов, вызываемых множественными изменениями данных. Вот почему на практике нe часто приходится использовать <code>Vue.nextTick</code> для ожидания, пока Vue выполнит фактическое обновление DOM после того, как мы инициируем некоторое изменение состояния.</p> <p>Для упрощения работы, <code>vue-test-utils</code> применяет все обновления синхронно, поэтому вам не потребуется использовать <code>Vue.nextTick</code> для ожидания обновления DOM в ваших тестах.</p> <p><em>Примечание: <code>nextTick</code> по-прежнему необходим, когда вам нужно явно форсировать цикл событий, для таких операций как асинхронные обратные вызовы или разрешение промисов.</em></p> <p>Если вам всё ещё нужно использовать <code>nextTick</code> в ваших тестовых файлах, имейте ввиду, что любые ошибки, выброшенные внутри него, могут не быть отловлены вашей программой для запуска тестов, поскольку внутри он реализован на Promise. Существует два подхода исправления этого: либо вы можете установить коллбэк <code>done</code> как глобальный обработчик ошибок Vue в начале теста, либо вы можете вызывать <code>nextTick</code> без аргумента и вернуть его как Promise:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// эта ошибка не будет отловлена</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'ошибка не будет отслеживаться'</span><span class="token punctuation">,</span> <span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Vue<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// два следующих теста будут работать как ожидается</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'должен отлавливать ошибку с использованием done'</span><span class="token punctuation">,</span> <span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>errorHandler <span class="token operator">=</span> done
  Vue<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'должен отлавливать ошибку с использованием promise'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Vue<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="что-даnьше"><a href="#что-даnьше" class="header-anchor">#</a> Что дальше</h3> <ul><li>Интегрируйте <code>vue-test-utils</code> в ваш проект выбрав <a href="/ru/guides/choosing-a-test-runner.html">программу для запуска тестов</a>.</li> <li>Прочитайте больше об <a href="/ru/guides/common-tips.html">общих техниках и советах при написании тестов</a>.</li></ul> <h2 id="общие-советы"><a href="#общие-советы" class="header-anchor">#</a> Общие советы</h2> <h3 id="понимание-что-тестировать"><a href="#понимание-что-тестировать" class="header-anchor">#</a> Понимание что тестировать</h3> <p>Для компонентов пользовательского интерфейса мы не рекомендуем стремиться к покрытию каждой строки кода, поскольку это приводит к слишком большому фокусу на деталях внутренней реализации компонентов и может привести к созданию хрупких тестов.</p> <p>Вместо этого, мы рекомендуем писать тесты, которые проверяют ваш публичный интерфейс взаимодействия с компонентом и относиться к его внутренностям как к чёрному ящику. Один тестовый пример должен проверять, что некоторые входные данные (взаимодействие пользователя или изменение входных параметров), предоставляемые компоненту будут приводить к ожидаемому результату (результату рендеринга или вызванным пользовательским событиям).</p> <p>Например, для компонента <code>Counter</code>, который при каждом нажатии кнопки будет увеличивать отображаемый счётчик на 1, может тестироваться с помощью симуляции клика и проверке, что в отрендренном результате значение будет увеличено на 1. Тест не заботится о том, каким образом <code>Counter</code> увеличивает значение, он сосредоточен только на входных данных и результате.</p> <p>Преимуществом этого подхода в том, что до тех пор пока интерфейс вашего компонента остаётся прежним, ваши тесты будут проходить независимо от того, как будет меняться внутренняя реализация компонента с течением времени.</p> <p>Эта тема обсуждается более подробно в <a href="https://www.youtube.com/watch?v=OIpfWTThrK8" target="_blank" rel="noopener noreferrer">отличной презентации Matt O'Connell<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h3 id="поверхностный-рендеринг"><a href="#поверхностный-рендеринг" class="header-anchor">#</a> Поверхностный рендеринг</h3> <p>В модульных тестах мы обычно хотим сосредоточиться на тестируемом компоненте, как на изолированном блоке и избежать неявной проверки поведения его дочерних компонентов.</p> <p>Кроме того, для компонентов, которые содержат много дочерних компонентов, отрендеренное дерево целиком может стать очень большим. Повторяющийся рендеринг всех дочерних компонентов может замедлить наши тесты.</p> <p><code>vue-test-utils</code> позволяет вам монтировать компонент без рендеринга его дочерних компонентов (заменяя их заглушками) с помощью метода <code>shallowMount</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>

<span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Component<span class="token punctuation">)</span>
wrapper<span class="token punctuation">.</span>vm <span class="token comment">// примонтированный экземпляр Vue</span>
</code></pre></div><h3 id="проверка-вызванных-событий"><a href="#проверка-вызванных-событий" class="header-anchor">#</a> Проверка вызванных событий</h3> <p>Каждая примонтированная обёртка автоматически записывает все события, вызванные на экземпляре Vue. Вы можете получить записанные события с помощью метода <code>wrapper.emitted()</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>
wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span>

<span class="token comment">/*
`wrapper.emitted()` возвращает указанный объект:
{
  foo: [[], [123]]
}
*/</span>
</code></pre></div><p>Затем вы можете добавить проверки на основе этих данных:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// проверка, что событие было вызвано</span>
<span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// проверка, что событие вызывалось определённое число раз</span>
<span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foo<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment">// проверка, что с событием были переданы определённые данные</span>
<span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foo<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">123</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>Вы также можете получить массив событий в порядке их вызова с помощью <a href="/ru/api/wrapper/emittedByOrder.html"><code>wrapper.emittedByOrder()</code></a>.</p> <h3 id="события-дочерних-компонентов"><a href="#события-дочерних-компонентов" class="header-anchor">#</a> События дочерних компонентов</h3> <p>Вы можете создавать пользовательские события в дочерних компонентах получая доступ к экземпляру.</p> <p><strong>Тестируемый компонент</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>child-component</span> <span class="token attr-name">@custom</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>onCustom<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>emitted<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Emitted!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> ChildComponent <span class="token keyword">from</span> <span class="token string">'./ChildComponent'</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'ParentComponent'</span><span class="token punctuation">,</span>
    components<span class="token punctuation">:</span> <span class="token punctuation">{</span> ChildComponent <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        emitted<span class="token punctuation">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token function">onCustom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>emitted <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>Тест</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> ParentComponent <span class="token keyword">from</span> <span class="token string">'@/components/ParentComponent'</span>
<span class="token keyword">import</span> ChildComponent <span class="token keyword">from</span> <span class="token string">'@/components/ChildComponent'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'ParentComponent'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;displays 'Emitted!' when custom event is emitted&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>ParentComponent<span class="token punctuation">)</span>
    wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>ChildComponent<span class="token punctuation">)</span><span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'custom'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">'Emitted!'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="манипуnирование-состоянием-компонента"><a href="#манипуnирование-состоянием-компонента" class="header-anchor">#</a> Манипулирование состоянием компонента</h3> <p>Вы можете напрямую манипулировать состоянием компонента с помощью методов <code>setData</code> или <code>setProps</code> на обёртке:</p> <div class="language-js extra-class"><pre class="language-js"><code>wrapper<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

wrapper<span class="token punctuation">.</span><span class="token function">setProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token punctuation">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="моки-входных-параметров"><a href="#моки-входных-параметров" class="header-anchor">#</a> Моки входных параметров</h3> <p>Вы можете передать входные параметры в компонент с использованием встроенной во Vue опции <code>propsData</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>

<span class="token function">mount</span><span class="token punctuation">(</span>Component<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  propsData<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    aProp<span class="token punctuation">:</span> <span class="token string">'some value'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Вы также можете обновить входные параметры на уже примонтированном компоненте с помощью метода <code>wrapper.setProps({})</code>.</p> <p><em>Полный список опции можно посмотреть в <a href="/ru/api/options.html">секции настроек монтирования</a> документации.</em></p> <h3 id="добавnение-гnобаnьных-пnагинов-и-примесей"><a href="#добавnение-гnобаnьных-пnагинов-и-примесей" class="header-anchor">#</a> Добавление глобальных плагинов и примесей</h3> <p>Некоторые из компонентов могут полагаться на функции, добавляемые глобальным плагином или примесью, к примеру <code>vuex</code> и <code>vue-router</code>.</p> <p>Если вы пишете тесты для компонентов определённого приложения, вы можете настроить одни и те же глобальные плагины и примеси один раз перед началом ваших тестов. Но в некоторых случаях, например при тестировании набора общих компонентов, которые могут использоваться в разных приложениях, гораздо лучше протестировать ваши компоненты в более изолированной конфигурации, без загрязнения глобального конструктора <code>Vue</code>. Мы можем использовать метод <a href="/ru/api/createLocalVue.html"><code>createLocalVue</code></a> для достижения этого:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createLocalVue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>

<span class="token comment">// создаём расширенный конструктор `Vue`</span>
<span class="token keyword">const</span> localVue <span class="token operator">=</span> <span class="token function">createLocalVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// устанавливаем плагины как обычно</span>
localVue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>MyPlugin<span class="token punctuation">)</span>

<span class="token comment">// передаём `localVue` в настройки монтирования</span>
<span class="token function">mount</span><span class="token punctuation">(</span>Component<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  localVue
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>Обратите внимание, что некоторые плагины, такие как Vue Router, добавляют свойства только для чтения к глобальному конструктору Vue. Это делает невозможным переустановку плагина на конструкторе localVue или добавление моков для этих свойств</strong></p> <h3 id="создание-моков-инъекций"><a href="#создание-моков-инъекций" class="header-anchor">#</a> Создание моков инъекций</h3> <p>Другая стратегия для инъекции входных параметров — просто создание их моков. Вы можете это сделать с помощью опции <code>mocks</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>

<span class="token keyword">const</span> $route <span class="token operator">=</span> <span class="token punctuation">{</span>
  path<span class="token punctuation">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
  hash<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  params<span class="token punctuation">:</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token string">'123'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  query<span class="token punctuation">:</span> <span class="token punctuation">{</span> q<span class="token punctuation">:</span> <span class="token string">'hello'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">mount</span><span class="token punctuation">(</span>Component<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  mocks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// добавление мока объекта `$route` в экземпляр Vue</span>
    <span class="token comment">// перед монтированием компонента</span>
    $route
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="подмена-компонентов"><a href="#подмена-компонентов" class="header-anchor">#</a> Подмена компонентов</h3> <p>Вы можете переопределить компоненты, зарегистрированные глобально или локально, используя опцию <code>stubs</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>

<span class="token function">mount</span><span class="token punctuation">(</span>Component<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// Компонент globally-registered-component</span>
  <span class="token comment">// будет заменяться пустой заглушкой</span>
  stubs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'globally-registered-component'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="работа-с-маршрутизацией"><a href="#работа-с-маршрутизацией" class="header-anchor">#</a> Работа с маршрутизацией</h3> <p>Поскольку маршрутизация по определению имеет отношение к общей структуре приложения и включает в себя несколько компонентов, её лучше всего тестировать с помощью интеграционных или end-to-end тестов. Для отдельных компонентов, которые используют возможности <code>vue-router</code>, вы можете создать моки с использованием упомянутых выше методов.</p> <h3 id="обнаружение-стиnей"><a href="#обнаружение-стиnей" class="header-anchor">#</a> Обнаружение стилей</h3> <p>Ваш тест может обнаруживать только встроенные стили при в <code>jsdom</code>.</p> <h2 id="тестирование-нажатий-кnавиш-мыши-и-других-событий-dom"><a href="#тестирование-нажатий-кnавиш-мыши-и-других-событий-dom" class="header-anchor">#</a> Тестирование нажатий клавиш, мыши и других событий DOM</h2> <h3 id="генерация-событий"><a href="#генерация-событий" class="header-anchor">#</a> Генерация событий</h3> <p><code>Wrapper</code> предоставляет метод <code>trigger</code>. Его можно использовать для генерации событий DOM.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>MyButton<span class="token punctuation">)</span>

wrapper<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
</code></pre></div><p>Вы должны помнить, что метод <code>find</code> также возвращает <code>Wrapper</code>. Предполагается, что <code>MyComponent</code> содержит кнопку, а следующий код нажимает эту кнопку.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">)</span>

wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="опции"><a href="#опции" class="header-anchor">#</a> Опции</h3> <p>Метод <code>trigger</code> также может опционально принимать объект <code>options</code>. Свойства объекта <code>options</code> добавятся к Event.</p> <p>Обратите внимание, что цель (target) не может добавлена в объект <code>options</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>MyButton<span class="token punctuation">)</span>

wrapper<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> button<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="пример-тестирования-кнопки-мыши"><a href="#пример-тестирования-кнопки-мыши" class="header-anchor">#</a> Пример тестирования кнопки мыши</h3> <p><strong>Тестируемый компонент</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>yes<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>callYes<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Yes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>no<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>callNo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>No<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'YesNoComponent'</span><span class="token punctuation">,</span>

    props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      callMe<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Function
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token function">callYes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callMe</span><span class="token punctuation">(</span><span class="token string">'yes'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">callNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callMe</span><span class="token punctuation">(</span><span class="token string">'no'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>Тест</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> YesNoComponent <span class="token keyword">from</span> <span class="token string">'@/components/YesNoComponent'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> sinon <span class="token keyword">from</span> <span class="token string">'sinon'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Click event'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Нажатие на кнопку yes вызывает наш метод с аргументом &quot;yes&quot;'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> spy <span class="token operator">=</span> sinon<span class="token punctuation">.</span><span class="token function">spy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>YesNoComponent<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      propsData<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        callMe<span class="token punctuation">:</span> spy
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button.yes'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>

    spy<span class="token punctuation">.</span>should<span class="token punctuation">.</span>have<span class="token punctuation">.</span>been<span class="token punctuation">.</span><span class="token function">calledWith</span><span class="token punctuation">(</span><span class="token string">'yes'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="пример-тестирования-кnавиши"><a href="#пример-тестирования-кnавиши" class="header-anchor">#</a> Пример тестирования клавиши</h3> <p><strong>Тестируемый компонент</strong></p> <p>Этот компонент позволяет увеличивать/уменьшать количество с помощью различных клавиш.</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@keydown.prevent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>onKeydown<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>quantity<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">const</span> <span class="token constant">KEY_DOWN</span> <span class="token operator">=</span> <span class="token number">40</span>
  <span class="token keyword">const</span> <span class="token constant">KEY_UP</span> <span class="token operator">=</span> <span class="token number">38</span>
  <span class="token keyword">const</span> <span class="token constant">ESCAPE</span> <span class="token operator">=</span> <span class="token number">27</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        quantity<span class="token punctuation">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>quantity <span class="token operator">+=</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>quantity <span class="token operator">-=</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>quantity <span class="token operator">=</span> <span class="token number">0</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">onKeydown</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>keyCode <span class="token operator">===</span> <span class="token constant">ESCAPE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>keyCode <span class="token operator">===</span> <span class="token constant">KEY_DOWN</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>keyCode <span class="token operator">===</span> <span class="token constant">KEY_UP</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>quantity <span class="token operator">=</span> <span class="token number">13</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">quantity</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>Тест</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> QuantityComponent <span class="token keyword">from</span> <span class="token string">'@/components/QuantityComponent'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Тестирование событий клавиш'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Quantity по умолчанию равно нулю'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>QuantityComponent<span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>quantity<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Клавиша вверх увеличивает quantity на 1'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>QuantityComponent<span class="token punctuation">)</span>
    wrapper<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'keydown.up'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>quantity<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Клавиша вниз уменьшает quantity на 1'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>QuantityComponent<span class="token punctuation">)</span>
    wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>quantity <span class="token operator">=</span> <span class="token number">5</span>
    wrapper<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'keydown.down'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>quantity<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Escape устанавливает quantity равным 0'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>QuantityComponent<span class="token punctuation">)</span>
    wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>quantity <span class="token operator">=</span> <span class="token number">5</span>
    wrapper<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'keydown.esc'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>quantity<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Магический символ &quot;a&quot; устанавливает quantity равным 13'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>QuantityComponent<span class="token punctuation">)</span>
    wrapper<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      key<span class="token punctuation">:</span> <span class="token string">'a'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>quantity<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>Ограничения</strong></p> <p>Имя модификатора после точки <code>keydown.up</code> преобразуется в <code>keyCode</code>. Это поддерживается для следующих имён:</p> <table><thead><tr><th>key name</th> <th>key code</th></tr></thead> <tbody><tr><td>enter</td> <td>13</td></tr> <tr><td>esc</td> <td>27</td></tr> <tr><td>tab</td> <td>9</td></tr> <tr><td>space</td> <td>32</td></tr> <tr><td>delete</td> <td>46</td></tr> <tr><td>backspace</td> <td>8</td></tr> <tr><td>insert</td> <td>45</td></tr> <tr><td>up</td> <td>38</td></tr> <tr><td>down</td> <td>40</td></tr> <tr><td>left</td> <td>37</td></tr> <tr><td>right</td> <td>39</td></tr> <tr><td>end</td> <td>35</td></tr> <tr><td>home</td> <td>36</td></tr> <tr><td>pageup</td> <td>33</td></tr> <tr><td>pagedown</td> <td>34</td></tr></tbody></table> <h3 id="важно"><a href="#важно" class="header-anchor">#</a> Важно</h3> <p>Vue Test Utils генерирует событие синхронно. Следовательно, <code>Vue.nextTick</code> не требуется.</p> <h2 id="чем-запускать-тесты"><a href="#чем-запускать-тесты" class="header-anchor">#</a> Чем запускать тесты</h2> <p>Test runner — это программа, которая запускает тесты.</p> <p>Есть много популярных программ запуска тестов для JavaScript, и <code>vue-test-utils</code> работает с любой из них. Нет зависимости от используемого test runner.</p> <p>Есть несколько вещей, которые следует учитывать при выборе программы запуска тестов: набор функций, производительность и поддержка предварительной компиляции однофайловых компонентов. После тщательного сравнения существующих библиотек мы рекомендуем два варианта конфигурации:</p> <ul><li><p><a href="https://jestjs.io/docs/en/getting-started.html#content" target="_blank" rel="noopener noreferrer">Jest<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> наиболее функциональный способ запуска тестов. Он меньше всех требует конфигурирования, устанавливает JSDOM по умолчанию, предоставляет встроенные проверки (assertions) и имеет отличный интерфейс для работы через командную строку. Тем не менее, вам понадобится пре-процессор, чтобы иметь возможность импортировать однофайловые компоненты в свои тесты. Мы создали пре-процессор <code>vue-jest</code>, который может обрабатывать наиболее распространённые функции однофайловых компонентов, но в настоящее время он не имеет 100% паритетности функций с <code>vue-loader</code>.</p></li> <li><p><a href="https://github.com/zinserjan/mocha-webpack" target="_blank" rel="noopener noreferrer">mocha-webpack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> — это обёртка вокруг webpack + Mocha, но с более оптимизированным интерфейсом и режимом отслеживания. Преимущества этой конфигурации в том, что мы можем получить полную поддержку однофайловых компонентов с помощью webpack + <code>vue-loader</code>, но для этого требуется больше настройки.</p></li></ul> <h3 id="браузерное-окружение"><a href="#браузерное-окружение" class="header-anchor">#</a> Браузерное окружение</h3> <p><code>vue-test-utils</code> полагается на браузерное окружение. Технически вы можете запустить его в реальном браузере, но это не рекомендуется из-за сложности запуска реальных браузеров на разных платформах. Вместо этого мы рекомендуем запускать тесты в Node с виртуальным браузерным окружением, реализуемым с помощью <a href="https://github.com/tmpvar/jsdom" target="_blank" rel="noopener noreferrer">JSDOM<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Jest настраивает JSDOM автоматически. Для других программ запуска тестов вы можете вручную настроить JSDOM для тестов с помощью <a href="https://github.com/rstacruz/jsdom-global" target="_blank" rel="noopener noreferrer">jsdom-global<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> в записи для ваших тестов:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev jsdom jsdom-global
</code></pre></div><hr> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// в настройке теста / entry</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsdom-global'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="тестирование-однофайnовых-компонентов"><a href="#тестирование-однофайnовых-компонентов" class="header-anchor">#</a> Тестирование однофайловых компонентов</h3> <p>Однофайловые компоненты Vue требуют предварительной компиляции, прежде чем могут быть запущены в Node или в браузере. Существует два рекомендуемых способа выполнения компиляции: с пре-процессором Jest, или непосредственно с помощью webpack.</p> <p>Пре-процессор <code>vue-jest</code> поддерживает базовую функциональность однофайловых компонентов, но в настоящее время не обрабатывает блоки стилей или пользовательские блоки, которые поддерживаются только в <code>vue-loader</code>. Если вы полагаетесь на эти функции или другие конфигурации, специфичные для webpack, вам нужно будет использовать связку webpack + <code>vue-loader</code>.</p> <p>Изучите следующие руководства по вариантам настройки:</p> <ul><li><a href="/ru/guides/testing-single-file-components-with-jest.html">Тестирование однофайловых компонентов с Jest</a></li> <li><a href="/ru/guides/testing-single-file-components-with-mocha-webpack.html">Тестирование однофайловых компонентов с Mocha + webpack</a></li></ul> <h3 id="допоnнитеnьные-ресурсы"><a href="#допоnнитеnьные-ресурсы" class="header-anchor">#</a> Дополнительные ресурсы</h3> <ul><li><a href="https://github.com/eddyerburgh/vue-unit-test-perf-comparison" target="_blank" rel="noopener noreferrer">Сравнение производительности программ для запуска тестов<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/vuejs/vue-test-utils-jest-example" target="_blank" rel="noopener noreferrer">Пример проекта с Jest<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/vuejs/vue-test-utils-mocha-webpack-example" target="_blank" rel="noopener noreferrer">Пример проекта с Mocha<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/eddyerburgh/vue-test-utils-tape-example" target="_blank" rel="noopener noreferrer">Пример проекта с tape<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/eddyerburgh/vue-test-utils-ava-example" target="_blank" rel="noopener noreferrer">Пример проекта с AVA<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/egoist/tyu" target="_blank" rel="noopener noreferrer">tyu — Восхитительное веб-тестирование от egoist<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="тестирование-однофайnовых-компонентов-с-jest"><a href="#тестирование-однофайnовых-компонентов-с-jest" class="header-anchor">#</a> Тестирование однофайловых компонентов с Jest</h2> <blockquote><p>Пример проекта для этой конфигурации доступен на <a href="https://github.com/vuejs/vue-test-utils-jest-example" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></blockquote> <p>Jest — это программа для запуска тестов, разработанная Facebook, направленная на предоставление функционального решения для модульного тестирования. Вы можете узнать больше о Jest в <a href="https://jestjs.io/" target="_blank" rel="noopener noreferrer">официальной документации<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h3 id="установка-jest"><a href="#установка-jest" class="header-anchor">#</a> Установка Jest</h3> <p>Предположим, что вы начинаете с конфигурации, где правильно настроены webpack, vue-loader и Babel — например, развёрнутый шаблон <code>webpack-simple</code> с помощью <code>vue-cli</code>.</p> <p>Первым делом нам необходимо установить Jest и <code>vue-test-utils</code>:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">install</span> --save-dev jest @vue/test-utils
</code></pre></div><p>Затем, необходимо указать псевдоним для запуска тестов в нашем <code>package.json</code>.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="обработка-однофайnовых-компонентов-с-jest"><a href="#обработка-однофайnовых-компонентов-с-jest" class="header-anchor">#</a> Обработка однофайловых компонентов с Jest</h3> <p>Чтобы научить Jest как обрабатывать <code>*.vue</code> файлы, нам необходимо установить и настроить пре-процессор <code>vue-jest</code>:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev vue-jest
</code></pre></div><p>Теперь, создадим секцию <code>jest</code> в файле <code>package.json</code>:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;moduleFileExtensions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;js&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
      <span class="token comment">// сообщаем Jest что необходимо обрабатывать `*.vue` файлы</span>
      <span class="token string">&quot;vue&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;transform&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// обрабатываем `*.vue` файлы с помощью `vue-jest`</span>
      <span class="token property">&quot;.*\\.(vue)$&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&lt;rootDir&gt;/node_modules/vue-jest&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><strong>Примечание:</strong> <code>vue-jest</code> в настоящее время не поддерживает все возможности <code>vue-loader</code>, например пользовательские блоки и загрузку стилей. Кроме того, некоторые функции, специфичные для webpack, такие как code-splitting, также не поддерживаются. Чтобы использовать их прочитайте руководство по <a href="/ru/guides/testing-single-file-components-with-mocha-webpack.html">тестированию однофайловых компонентов с Mocha + webpack</a>.</p></blockquote> <h3 id="обработка-псевдонимов-webpack"><a href="#обработка-псевдонимов-webpack" class="header-anchor">#</a> Обработка псевдонимов webpack</h3> <p>Если вы используете псевдонимы в конфигурации webpack, например когда <code>@</code> ссылается на путь <code>/src</code>, вам также нужно добавить соответствующую конфигурацию для Jest, используя опцию <code>moduleNameMapper</code>:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token comment">// добавление поддержки псевдонима @ -&gt; src в исходном коде</span>
    <span class="token property">&quot;moduleNameMapper&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;^@/(.*)$&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&lt;rootDir&gt;/src/$1&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="конфигурация-babel-дnя-jest"><a href="#конфигурация-babel-дnя-jest" class="header-anchor">#</a> Конфигурация Babel для Jest</h3> <p>Хотя последние версии Node уже поддерживают большинство функций ES2015, вы всё равно можете использовать синтаксис ES-модулей и stage-x функции в ваших тестах. Для этого нужно установить <code>babel-jest</code>:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev babel-jest
</code></pre></div><p>Затем мы должны сообщить Jest обрабатывать файлы тестов с JavaScript с помощью <code>babel-jest</code>, добавив запись <code>jest.transform</code> в <code>package.json</code>:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token property">&quot;transform&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
      <span class="token comment">// обрабатывать js с помощью `babel-jest`</span>
      <span class="token property">&quot;^.+\\.js$&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&lt;rootDir&gt;/node_modules/babel-jest&quot;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>По умолчанию <code>babel-jest</code> автоматически настраивается по установке. Однако, поскольку мы явно добавили преобразование файлов <code>*.vue</code>, нам теперь нужно также настроить <code>babel-jest</code>.</p></blockquote> <p>Предполагая использование <code>babel-preset-env</code> с webpack, конфигурация Babel по умолчанию отключает транспиляцию ES-модулей, потому что webpack уже знает как обрабатывать ES-модули. Однако нам нужно включить его для наших тестов, потому что тесты Jest запускаются непосредственно в Node.</p> <p>Кроме того, мы можем указать <code>babel-preset-env</code> в качестве цели используемую нами версию Node. Это пропустит транспиляцию ненужных функций и ускорит загрузку тестов.</p> <p>Чтобы применить эти параметры только для тестов, поместите их в отдельную конфигурацию в <code>env.test</code> (это будет автоматически обработано <code>babel-jest</code>).</p> <p>Пример <code>.babelrc</code>:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;env&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token property">&quot;modules&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;env&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token property">&quot;targets&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;current&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="распоnожение-файnов-тестов"><a href="#распоnожение-файnов-тестов" class="header-anchor">#</a> Расположение файлов тестов</h3> <p>По умолчанию Jest будет рекурсивно выбирать все файлы с расширением <code>.spec.js</code> или <code>.test.js</code> во всём проекте. Если это поведение не соответствует вашим потребностям, то возможно <a href="https://jestjs.io/docs/en/configuration.html#testregex-string-array-string" target="_blank" rel="noopener noreferrer">изменить <code>testRegex</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> в секции конфигурации в файле <code>package.json</code>.</p> <p>Jest рекомендует создать каталог <code>__tests__</code> рядом с тестируемым кодом, но не стесняйтесь структурировать ваши тесты по своему усмотрению. Просто остерегайтесь того, что Jest создаст каталог <code>__snapshots__</code> рядом с тестовыми файлами, который необходим для тестирования с помощью моментальных снимков.</p> <h3 id="покрытие-кода-coverage"><a href="#покрытие-кода-coverage" class="header-anchor">#</a> Покрытие кода (Coverage)</h3> <p>Jest может быть использован для генерации отчётов о покрытии кода в нескольких форматах. Ниже приведён простой пример для начала:</p> <p>Расширьте вашу конфигурацию <code>jest</code> (обычно расположенную в <code>package.json</code> или <code>jest.config.js</code>) с помощью опции <a href="https://jestjs.io/docs/en/configuration.html#collectcoverage-boolean" target="_blank" rel="noopener noreferrer">collectCoverage<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, и затем добавьте массив <a href="https://jestjs.io/docs/en/configuration.html#collectcoveragefrom-array" target="_blank" rel="noopener noreferrer">collectCoverageFrom<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> для определения файлов, для которых требуется собирать информацию о покрытии.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token property">&quot;collectCoverage&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;collectCoverageFrom&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;**/*.{js,vue}&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;!**/node_modules/**&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Это включит отчёты о покрытии с использованием <a href="https://jestjs.io/docs/en/configuration.html#coveragereporters-array-string" target="_blank" rel="noopener noreferrer">стандартных отчётов о покрытии<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Вы можете настроить их с помощью опции <code>coverageReporters</code>:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token property">&quot;coverageReporters&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;html&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text-summary&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Дополнительную информацию можно найти в <a href="https://jestjs.io/docs/en/configuration.html#collectcoverage-boolean" target="_blank" rel="noopener noreferrer">документации по конфигурации Jest<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, где вы можете найти параметры для пороговых значений покрытия, каталоги вывода данных и т.д.</p> <h3 id="пример-спецификации"><a href="#пример-спецификации" class="header-anchor">#</a> Пример спецификации</h3> <p>Если вы знакомы с Jasmine, то вы должны чувствовать себя как дома с <a href="https://jestjs.io/docs/en/expect.html#content" target="_blank" rel="noopener noreferrer">проверочным API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> Jest:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Component <span class="token keyword">from</span> <span class="token string">'./component'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Component'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'является экземпляром Vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>Component<span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">isVueInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="тестирование-моментаnьными-снимками"><a href="#тестирование-моментаnьными-снимками" class="header-anchor">#</a> Тестирование моментальными снимками</h3> <p>Когда вы монтируете компонент с помощью Vue Test Utils, вы получаете доступ к корневому элементу HTML. Это можно сохранить в виде моментального снимка для <a href="https://jestjs.io/docs/en/snapshot-testing.html" target="_blank" rel="noopener noreferrer">тестирования моментальными снимками в Jest<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'renders correctly'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>Component<span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Мы можем улучшить сохраненный снимок с помощью пользовательского сериализатора:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev jest-serializer-vue
</code></pre></div><p>Затем настройте <code>jest-serializer-vue</code> в <code>package.json</code>:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token comment">// сериализатор для снимков</span>
    <span class="token property">&quot;snapshotSerializers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;jest-serializer-vue&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="ресурсы"><a href="#ресурсы" class="header-anchor">#</a> Ресурсы</h3> <ul><li><a href="https://github.com/vuejs/vue-test-utils-jest-example" target="_blank" rel="noopener noreferrer">Пример проекта для этой конфигурации<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/codebryo/vue-testing-with-jest-conf17" target="_blank" rel="noopener noreferrer">Примеры и слайды с Vue Conf 2017<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://jestjs.io/" target="_blank" rel="noopener noreferrer">Jest<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/babel/babel-preset-env" target="_blank" rel="noopener noreferrer">Babel preset env<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="тестирование-однофайnовых-компонентов-с-mocha-и-webpack"><a href="#тестирование-однофайnовых-компонентов-с-mocha-и-webpack" class="header-anchor">#</a> Тестирование однофайловых компонентов с Mocha и webpack</h2> <blockquote><p>Пример проекта для этой конфигурации доступен на <a href="https://github.com/vuejs/vue-test-utils-mocha-webpack-example" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></blockquote> <p>Другая стратегия тестирования однофайловых компонентов заключается в компиляции всех наших тестов с помощью webpack, а затем программой для запуска тестов. Преимущество такого подхода заключается в том, что он даёт нам полную поддержку всех функций webpack и <code>vue-loader</code>, поэтому нам не нужно идти на компромиссы в нашем исходном коде.</p> <p>Технически, вы можете использовать любую программу для запуска тестов, которая вам нравится, и вручную соединять вещи, но мы нашли <a href="https://github.com/zinserjan/mocha-webpack" target="_blank" rel="noopener noreferrer"><code>mocha-webpack</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> как очень удобный способ для реализации этой задачи.</p> <h3 id="настройка-mocha-webpack"><a href="#настройка-mocha-webpack" class="header-anchor">#</a> Настройка <code>mocha-webpack</code></h3> <p>Мы предположим, что вы начинаете с настройки, когда уже есть правильно настроенные webpack, vue-loader и Babel — например используя шаблон <code>webpack-simple</code>, развёрнутый с помощью <code>vue-cli</code>.</p> <p>Первое, что нужно сделать, это установить тестовые зависимости:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev @vue/test-utils mocha mocha-webpack
</code></pre></div><p>Затем мы должны указать скрипт test в нашем <code>package.json</code>.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mocha-webpack --webpack-config webpack.config.js --require test/setup.js test/**/*.spec.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Несколько вещей, о том что мы сделали:</p> <ul><li><p>Флаг <code>--webpack-config</code> указывает конфигурационный файл webpack для использования в тестах. В большинстве случаев это будут идентичная конфигурация, используемой в проекте, с одной небольшой доработкой. Мы поговорим об этом позднее.</p></li> <li><p>Флаг <code>--require</code> гарантирует, что файл <code>test/setup.js</code> будет запущен перед любыми тестами, в котором мы можем настроить для наших тестов глобальное окружение, в котором они будут запускаться.</p></li> <li><p>Последний аргумент — это шаблон для тестовых файлов, которые будут включены в тестовую сборку.</p></li></ul> <h3 id="допоnнитеnьная-конфигурация-webpack"><a href="#допоnнитеnьная-конфигурация-webpack" class="header-anchor">#</a> Дополнительная конфигурация webpack</h3> <h4 id="вынесение-внешних-npm-зависимостей"><a href="#вынесение-внешних-npm-зависимостей" class="header-anchor">#</a> Вынесение внешних NPM-зависимостей</h4> <p>В наших тестах мы, скорее всего, импортируем ряд NPM-зависимостей — некоторые из этих модулей могут быть написаны не для использования в браузере и просто не смогут быть корректно добавлены в сборку webpack. Другой плюс в том, что извлечение внешних зависимостей значительно улучшит скорость загрузки тестов. Мы можем вынести все NPM-зависимости с помощью <code>webpack-node-externals</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
<span class="token keyword">const</span> nodeExternals <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-node-externals'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  externals<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token function">nodeExternals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="source-maps"><a href="#source-maps" class="header-anchor">#</a> Source Maps</h4> <p>Source maps должны быть встроены для использования в <code>mocha-webpack</code>. Рекомендуемая конфигурация:</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  devtool<span class="token punctuation">:</span> <span class="token string">'inline-cheap-module-source-map'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>При отладке через IDE рекомендуется также добавить следующее:</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token comment">// использовать абсолютные пути в sourcemaps (важно для отладки через IDE)</span>
    devtoolModuleFilenameTemplate<span class="token punctuation">:</span> <span class="token string">'[absolute-resource-path]'</span><span class="token punctuation">,</span>
    devtoolFallbackModuleFilenameTemplate<span class="token punctuation">:</span> <span class="token string">'[absolute-resource-path]?[hash]'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="настройка-браузерного-окружения"><a href="#настройка-браузерного-окружения" class="header-anchor">#</a> Настройка браузерного окружения</h3> <p><code>vue-test-utils</code> требует браузерного окружения для запуска. Мы можем симулировать его в Node используя <code>jsdom-global</code>:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev jsdom jsdom-global
</code></pre></div><p>Затем в <code>test/setup.js</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsdom-global'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>Это добавит браузерное окружение в Node, таким образом <code>vue-test-utils</code> сможет корректно запуститься.</p> <h3 id="выбор-бибnиотеки-утверждений"><a href="#выбор-бибnиотеки-утверждений" class="header-anchor">#</a> Выбор библиотеки утверждений</h3> <p><a href="http://chaijs.com/" target="_blank" rel="noopener noreferrer">Chai<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> — популярная библиотека утверждений, которая обычно используется вместе с Mocha. Вы также можете воспользоваться <a href="http://sinonjs.org/" target="_blank" rel="noopener noreferrer">Sinon<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> для создания шпионов и заглушек.</p> <p>В качестве альтернативы вы можете использовать <code>expect</code>, который является частью Jest и реализует <a href="http://facebook.github.io/jest/docs/en/expect.html#content" target="_blank" rel="noopener noreferrer">точно такой же API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> в документации Jest.</p> <p>Мы будем использовать <code>expect</code> здесь и сделаем его глобально доступным, чтобы нам не приходилось импортировать его в каждом тесте:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev <span class="token function">expect</span>
</code></pre></div><p>Затем в <code>test/setup.js</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsdom-global'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

global<span class="token punctuation">.</span>expect <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'expect'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="оптимизация-babel-дnя-тестов"><a href="#оптимизация-babel-дnя-тестов" class="header-anchor">#</a> Оптимизация Babel для тестов</h3> <p>Обратите внимание, что мы используем <code>babel-loader</code> для обработки JavaScript. У вас уже должен быть настроен Babel, если вы используете его в своём приложении, через файл <code>.babelrc</code>. Здесь <code>babel-loader</code> будет автоматически использовать тот же файл конфигурации.</p> <p>Следует отметить, что если вы используете Node 6+, которая уже поддерживает большинство функций ES2015, вы можете настроить отдельную <a href="https://babeljs.io/docs/usage/babelrc/#env-option" target="_blank" rel="noopener noreferrer">опцию env<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> Babel, которая будет транспилировать только те функции, которые ещё не поддерживаются в используемой версии Node (например, <code>stage-2</code> или поддержку синтаксиса flow, и т.п.).</p> <h3 id="добавnение-теста"><a href="#добавnение-теста" class="header-anchor">#</a> Добавление теста</h3> <p>Создайте файл в <code>src</code> названный <code>Counter.vue</code>:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    {{ count }}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>increment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Увеличить<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        count<span class="token punctuation">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">++</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>И создайте файл теста, названный <code>test/Counter.spec.js</code> со следующим кодом:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">'../src/Counter.vue'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Counter.vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'увеличивает счётчик по нажатию кнопки'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span>
    wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatch</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>И теперь мы можем запустить тест:</p> <div class="language- extra-class"><pre class="language-text"><code>npm run test
</code></pre></div><p>Ура, мы запустили наши тесты!</p> <h3 id="покрытие-кода-coverage-2"><a href="#покрытие-кода-coverage-2" class="header-anchor">#</a> Покрытие кода (Coverage)</h3> <p>Для настройки покрытия кода в mocha-webpack, следуйте <a href="https://github.com/zinserjan/mocha-webpack/blob/master/docs/guides/code-coverage.md" target="_blank" rel="noopener noreferrer">инструкции по настройке покрытия кода mocha-webpack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h3 id="ресурсы-2"><a href="#ресурсы-2" class="header-anchor">#</a> Ресурсы</h3> <ul><li><a href="https://github.com/vuejs/vue-test-utils-mocha-webpack-example" target="_blank" rel="noopener noreferrer">Пример проекта для этой настройки<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://mochajs.org/" target="_blank" rel="noopener noreferrer">Mocha<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://zinserjan.github.io/mocha-webpack/" target="_blank" rel="noopener noreferrer">mocha-webpack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://chaijs.com/" target="_blank" rel="noopener noreferrer">Chai<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://sinonjs.org/" target="_blank" rel="noopener noreferrer">Sinon<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://facebook.github.io/jest/docs/en/expect.html#content" target="_blank" rel="noopener noreferrer">jest/expect<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="тестирование-однофайnовых-компонентов-с-karma"><a href="#тестирование-однофайnовых-компонентов-с-karma" class="header-anchor">#</a> Тестирование однофайловых компонентов с Karma</h2> <blockquote><p>Пример проекта для этой конфигурации доступен на <a href="https://github.com/eddyerburgh/vue-test-utils-karma-example" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></blockquote> <p>Karma — это программа для запуска тестов, которая открывает браузеры, выполняет тесты и сообщает нам об их результатах. Мы собираемся использовать фреймворк Mocha для написания тестов. Мы будем использовать библиотеку chai для тестовых утверждений.</p> <h3 id="установка-mocha"><a href="#установка-mocha" class="header-anchor">#</a> Установка Mocha</h3> <p>Предположим, что вы начинаете с конфигурации, где правильно настроены webpack, vue-loader и Babel — например, развёрнутый шаблон <code>webpack-simple</code> с помощью <code>vue-cli</code>.</p> <p>Первым делом нам необходимо установить тестовые зависимости:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev @vue/test-utils karma karma-chrome-launcher karma-mocha karma-sourcemap-loader karma-spec-reporter karma-webpack mocha
</code></pre></div><p>Далее нам нужно определить скрипт для запуска тестов в <code>package.json</code>.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;karma start --single-run&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Флаг <code>--single-run</code> указывает Karma запускать набор тестов только один раз.</li></ul> <h3 id="karma-configuration"><a href="#karma-configuration" class="header-anchor">#</a> Karma Configuration</h3> <p>Создайте файл <code>karma.conf.js</code> в корне вашего проекта:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// karma.conf.js</span>

<span class="token keyword">var</span> webpackConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.config.js'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  config<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    frameworks<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'mocha'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    files<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'test/**/*.spec.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    preprocessors<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">'**/*.spec.js'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'webpack'</span><span class="token punctuation">,</span> <span class="token string">'sourcemap'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    webpack<span class="token punctuation">:</span> webpackConfig<span class="token punctuation">,</span>

    reporters<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'spec'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    browsers<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'Chrome'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Этот файл используется для настройки Karma.</p> <p>Нам нужно предварительно обработать файлы с помощью webpack. Для этого мы добавляем webpack в качестве препроцессора и включаем нашу конфигурацию webpack. Мы можем использовать конфигурационный файл webpack в корне проекте, ничего не меняя.</p> <p>В нашей конфигурации мы запускаем тесты в Chrome. Для добавления дополнительных браузеров смотрите <a href="http://karma-runner.github.io/3.0/config/browsers.html" target="_blank" rel="noopener noreferrer">раздел Браузеры в документации Karma<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h3 id="выбор-бибnиотеки-утверждений-2"><a href="#выбор-бибnиотеки-утверждений-2" class="header-anchor">#</a> Выбор библиотеки утверждений</h3> <p><a href="http://chaijs.com/" target="_blank" rel="noopener noreferrer">Chai<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> - популярная библиотека утверждений, которая обычно используется вместе с Mocha. Вы посмотреть на <a href="http://sinonjs.org/" target="_blank" rel="noopener noreferrer">Sinon<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> для создания шпионов и заглушек.</p> <p>Мы можем установить плагин <code>karma-chai</code> для использования <code>chai</code> в наших тестах.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev karma-chai
</code></pre></div><h3 id="добавnение-теста-2"><a href="#добавnение-теста-2" class="header-anchor">#</a> Добавление теста</h3> <p>Создайте в каталоге <code>src</code> файл с именем <code>Counter.vue</code>:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    {{ count }}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>increment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Increment<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        count<span class="token punctuation">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">++</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>И создайте файл <code>test/Counter.spec.js</code> со следующим кодом:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'chai'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">'../src/Counter.vue'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Counter.vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'increments count when button is clicked'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span>
    wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>И теперь мы можем запустить тесты:</p> <div class="language- extra-class"><pre class="language-text"><code>npm run test
</code></pre></div><p>Ура, наши тесты работают!</p> <h3 id="покрытие-кода"><a href="#покрытие-кода" class="header-anchor">#</a> Покрытие кода</h3> <p>Для настройки покрытия кода Karma, мы можем использовать плагин <code>karma-coverage</code>.</p> <p>По умолчанию <code>karma-coverage</code> не будет использовать исходные карты для отображения отчётов о покрытии. Поэтому нам нужно использовать <code>babel-plugin-istanbul</code>, чтобы убедиться, что покрытие правильно работает.</p> <p>Установите <code>karma-coverage</code>, <code>babel-plugin-istanbul</code> и <code>cross-env</code>:</p> <div class="language- extra-class"><pre class="language-text"><code>npm install --save-dev karma-coverage cross-env
</code></pre></div><p>Мы собираемся использовать <code>cross-env</code> для установки переменной окружения <code>BABEL_ENV</code>. Таким образом, мы можем использовать <code>babel-plugin-istanbul</code> при компиляции наших тестов — мы не хотим включать <code>babel-plugin-istnabul</code> при компиляции нашего кода в production:</p> <div class="language- extra-class"><pre class="language-text"><code>npm install --save-dev babel-plugin-istanbul
</code></pre></div><p>Обновите файл <code>.babelrc</code> для использования <code>babel-plugin-istanbul</code>, когда <code>BABEL_ENV</code> равняется test:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;env&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token property">&quot;modules&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;stage-3&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;istanbul&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Теперь обновите файл <code>karma.conf.js</code> для использования покрытия кода. Добавьте <code>coverage</code> в массив <code>reporters</code> и добавьте поле <code>coverageReporter</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// karma.conf.js</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  config<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// ...</span>

    reporters<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'spec'</span><span class="token punctuation">,</span> <span class="token string">'coverage'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    coverageReporter<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      dir<span class="token punctuation">:</span> <span class="token string">'./coverage'</span><span class="token punctuation">,</span>
      reporters<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'lcov'</span><span class="token punctuation">,</span> subdir<span class="token punctuation">:</span> <span class="token string">'.'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'text-summary'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>И обновите тестовый скрипт <code>test</code> для установки <code>BABEL_ENV</code>:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env BABEL_ENV=test karma start --single-run&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="ресурсы-3"><a href="#ресурсы-3" class="header-anchor">#</a> Ресурсы</h3> <ul><li><a href="https://github.com/eddyerburgh/vue-test-utils-karma-example" target="_blank" rel="noopener noreferrer">Пример проекта для этой конфигурации<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://karma-runner.github.io/" target="_blank" rel="noopener noreferrer">Karma<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://mochajs.org/" target="_blank" rel="noopener noreferrer">Mocha<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://chaijs.com/" target="_blank" rel="noopener noreferrer">Chai<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://sinonjs.org/" target="_blank" rel="noopener noreferrer">Sinon<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="тестирование-асинхронной-nогики"><a href="#тестирование-асинхронной-nогики" class="header-anchor">#</a> Тестирование асинхронной логики</h2> <p>Чтобы упростить тестирование, <code>vue-test-utils</code> применяет обновления DOM <em>синхронно</em>. Однако, есть некоторые тонкости, когда вам необходимо протестировать компонент с асинхронным поведением, таким как коллбэки или промисы.</p> <p>Одними из самых распространённых поведений являются запросы к API и действия Vuex. В примерах ниже будет показано как протестировать метод, который делает запрос к API. В этом примере используется Jest для запуска тестов и мок для HTTP-библиотеки <code>axios</code>. Подробнее о использовании моков в Jest можно прочитать <a href="https://jestjs.io/docs/en/manual-mocks.html#content" target="_blank" rel="noopener noreferrer">здесь<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Реализация мока для <code>axios</code> выглядит так:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data<span class="token punctuation">:</span> <span class="token string">'value'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Компонент ниже делает вызов к API при нажатии кнопки и сохраняет полученный ответ в <code>value</code>.</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fetchResults<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        value<span class="token punctuation">:</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">async</span> <span class="token function">fetchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'mock/service'</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> response<span class="token punctuation">.</span>data
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Тест можно написать следующим образом:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Foo <span class="token keyword">from</span> <span class="token string">'./Foo'</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'делает асинхронный запрос при нажатии кнопки'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Foo<span class="token punctuation">)</span>
  wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>В настоящее время этот тест не будет успешно проходить, потому что проверка значения вызывается до разрешения промиса <code>fetchResults</code>. Большинство библиотек для модульного тестирования предоставляют коллбэк, чтобы предоставить возможность определять когда тест должен будет завершаться. Jest и Mocha используют <code>done</code>. Мы можем использовать <code>done</code> в комбинации с <code>$nextTick</code> или <code>setTimeout</code>, чтобы гарантировать, что любые промисы будут разрешены перед проверками.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'делает асинхронный запрос при нажатии кнопки'</span><span class="token punctuation">,</span> <span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Foo<span class="token punctuation">)</span>
  wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
  wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">)</span>
    <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Необходимость <code>$nextTick</code> или <code>setTimeout</code> требуется для прохождения теста, потому что очередь микрозадач, в которой обрабатываются промисы, обрабатывается до очереди задач, где обрабатываются <code>$nextTick</code> и <code>setTimeout</code>. Это означает, что к моменту запуска <code>$nextTick</code> и <code>setTimeout</code>, будут выполнены любые коллбэки промисов. См. <a href="https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/" target="_blank" rel="noopener noreferrer">здесь<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> для более подробного объяснения.</p> <p>Другое решение — использовать <code>async</code> функцию и npm-пакет <code>flush-promises</code>. <code>flush-promises</code> сбрасывает все ожидаемые промисы. Вы можете использовать <code>await</code> вызов для <code>flushPromises</code> чтобы очистить все ожидаемые промисы и улучшить читаемость вашего теста.</p> <p>Обновлённый тест будет выглядеть так:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> flushPromises <span class="token keyword">from</span> <span class="token string">'flush-promises'</span>
<span class="token keyword">import</span> Foo <span class="token keyword">from</span> <span class="token string">'./Foo'</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'делает асинхронный запрос при нажатии кнопки'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Foo<span class="token punctuation">)</span>
  wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">flushPromises</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Подобная техника может применяться и для действий Vuex, которые возвращают promise по умолчанию.</p> <h2 id="using-with-typescript"><a href="#using-with-typescript" class="header-anchor">#</a> Using with TypeScript</h2> <blockquote><p>An example project for this setup is available on <a href="https://github.com/vuejs/vue-test-utils-typescript-example" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></blockquote> <p>TypeScript is a popular superset of JavaScript that adds types and classes on top of regular JS. Vue Test Utils includes types in the distributed package, so it works well with TypeScript.</p> <p>In this guide, we'll walk through how to setup a testing setup for a TypeScript project using Jest and Vue Test Utils from a basic Vue CLI TypeScript setup.</p> <h3 id="adding-typescript"><a href="#adding-typescript" class="header-anchor">#</a> Adding TypeScript</h3> <p>First you need to create a project. If you don't have Vue CLI installed, install it globally:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">npm</span> <span class="token function">install</span> -g @vue/cli
</code></pre></div><p>And create a project by running:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ vue create hello-world
</code></pre></div><p>In the CLI prompt, choose to <code>Manually select features</code>, select TypeScript, and press enter. This will create a project with TypeScript already configured.</p> <div class="tip custom-block"><p class="custom-block-title">NOTE</p> <p>If you want a more detailed guide on setting up Vue with TypeScript, checkout the <a href="https://github.com/Microsoft/TypeScript-Vue-Starter" target="_blank" rel="noopener noreferrer">TypeScript Vue starter guide<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div> <p>The next step is to add Jest to the project.</p> <h3 id="setting-up-jest"><a href="#setting-up-jest" class="header-anchor">#</a> Setting up Jest</h3> <p>Jest is a test runner developed by Facebook, aiming to deliver a battery-included unit testing solution. You can learn more about Jest on its <a href="https://jestjs.io/" target="_blank" rel="noopener noreferrer">official documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Install Jest and Vue Test Utils:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">install</span> --save-dev jest @vue/test-utils
</code></pre></div><p>Next define a <code>test:unit</code> script in <code>package.json</code>.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
  <span class="token comment">// ..</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ..</span>
    <span class="token property">&quot;test:unit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest&quot;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ..</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="processing-single-file-components-in-jest"><a href="#processing-single-file-components-in-jest" class="header-anchor">#</a> Processing Single-File Components in Jest</h3> <p>To teach Jest how to process <code>*.vue</code> files, we need to install and configure the <code>vue-jest</code> preprocessor:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev vue-jest
</code></pre></div><p>Next, create a <code>jest</code> block in <code>package.json</code>:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;moduleFileExtensions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;js&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;ts&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
      <span class="token comment">// tell Jest to handle `*.vue` files</span>
      <span class="token string">&quot;vue&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;transform&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// process `*.vue` files with `vue-jest`</span>
      <span class="token property">&quot;.*\\.(vue)$&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-jest&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;testURL&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost/&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="configuring-typescript-for-jest"><a href="#configuring-typescript-for-jest" class="header-anchor">#</a> Configuring TypeScript for Jest</h3> <p>In order to use TypeScript files in tests, we need to set up Jest to compile TypeScript. For that we need to install <code>ts-jest</code>:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">install</span> --save-dev ts-jest
</code></pre></div><p>Next, we need to tell Jest to process TypeScript test files with <code>ts-jest</code> by adding an entry under <code>jest.transform</code> in <code>package.json</code>:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token property">&quot;transform&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
      <span class="token comment">// process `*.ts` files with `ts-jest`</span>
      <span class="token property">&quot;^.+\\.tsx?$&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ts-jest&quot;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="placing-test-files"><a href="#placing-test-files" class="header-anchor">#</a> Placing Test Files</h3> <p>By default, Jest will recursively pick up all files that have a <code>.spec.js</code> or <code>.test.js</code> extension in the entire project.</p> <p>To run test files with a <code>.ts</code> extension, we need to change the <code>testRegex</code> in the config section in the <code>package.json</code> file.</p> <p>Add the following to the <code>jest</code> field in <code>package.json</code>:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token property">&quot;testRegex&quot;</span><span class="token operator">:</span> <span class="token string">&quot;(/__tests__/.*|(\\.|/)(test|spec))\\.(jsx?|tsx?)$&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Jest recommends creating a <code>__tests__</code> directory right next to the code being tested, but feel free to structure your tests as you see fit. Just beware that Jest would create a <code>__snapshots__</code> directory next to test files that performs snapshot testing.</p> <h3 id="writing-a-unit-test"><a href="#writing-a-unit-test" class="header-anchor">#</a> Writing a unit test</h3> <p>Now we've got the project set up, it's time to write a unit test.</p> <p>Create a <code>src/components/__tests__/HelloWorld.spec.ts</code> file, and add the following code:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/components/__tests__/HelloWorld.spec.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> HelloWorld <span class="token keyword">from</span> <span class="token string">'../HelloWorld.vue'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'HelloWorld.vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'renders props.msg when passed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token string">'new message'</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>HelloWorld<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      propsData<span class="token punctuation">:</span> <span class="token punctuation">{</span> msg <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatch</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>That's all we need to do to get TypeScript and Vue Test Utils working together!</p> <h3 id="resources"><a href="#resources" class="header-anchor">#</a> Resources</h3> <ul><li><a href="https://github.com/vuejs/vue-test-utils-typescript-example" target="_blank" rel="noopener noreferrer">Example project for this setup<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://jestjs.io/" target="_blank" rel="noopener noreferrer">Jest<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="испоnьзование-с-vue-router"><a href="#испоnьзование-с-vue-router" class="header-anchor">#</a> Использование с Vue Router</h2> <h3 id="установка-vue-router-в-тестах"><a href="#установка-vue-router-в-тестах" class="header-anchor">#</a> Установка Vue Router в тестах</h3> <p>Вы никогда не должны устанавливать Vue Router в базовый конструктор Vue в тестах. Установка Vue Router добавляет <code>$route</code> и <code>$router</code> как свойства только для чтения на прототипе Vue.</p> <p>Чтобы этого избежать, мы можем создать localVue и установить Vue Router на него.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount<span class="token punctuation">,</span> createLocalVue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">'vue-router'</span>

<span class="token keyword">const</span> localVue <span class="token operator">=</span> <span class="token function">createLocalVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
localVue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueRouter<span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">shallowMount</span><span class="token punctuation">(</span>Component<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  localVue<span class="token punctuation">,</span>
  router
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p><strong>Примечание:</strong> Установка Vue Router на <code>localVue</code> также добавляет <code>$route</code> и <code>$router</code> в качестве свойство только для чтения <code>localVue</code>. Это означает, что вы можете использовать опцию <code>mocks</code> для перезаписи <code>$route</code> и <code>$router</code> при монтировании компонента, используя <code>localVue</code> с установленным Vue Router.</p></blockquote> <h3 id="тестирование-компонентов-испоnьзующих-router-link-иnи-router-view"><a href="#тестирование-компонентов-испоnьзующих-router-link-иnи-router-view" class="header-anchor">#</a> Тестирование компонентов использующих <code>router-link</code> или <code>router-view</code></h3> <p>Когда вы устанавливаете Vue Router, регистрируются глобальные компоненты <code>router-link</code> и <code>router-view</code>. Это означает, что мы можем использовать их в любом месте нашего приложения без необходимости импортировать их.</p> <p>Когда мы запускаем тесты, нам нужно сделать эти компоненты vue-router доступными для компонента, который мы монтируем. Есть два способа сделать это.</p> <h4 id="испоnьзование-загnушек-stubs"><a href="#испоnьзование-загnушек-stubs" class="header-anchor">#</a> Использование заглушек (stubs)</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>

<span class="token function">shallowMount</span><span class="token punctuation">(</span>Component<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  stubs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'router-link'</span><span class="token punctuation">,</span> <span class="token string">'router-view'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="установка-vue-router-с-помощью-localvue"><a href="#установка-vue-router-с-помощью-localvue" class="header-anchor">#</a> Установка Vue Router с помощью localVue</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount<span class="token punctuation">,</span> createLocalVue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">'vue-router'</span>

<span class="token keyword">const</span> localVue <span class="token operator">=</span> <span class="token function">createLocalVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
localVue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueRouter<span class="token punctuation">)</span>

<span class="token function">shallowMount</span><span class="token punctuation">(</span>Component<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  localVue
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="создание-моков-route-и-router"><a href="#создание-моков-route-и-router" class="header-anchor">#</a> Создание моков <code>$route</code> и <code>$router</code></h3> <p>Иногда вам может потребоваться протестировать, что компонент что-то делает с параметрами объектов <code>$route</code> и <code>$router</code>. Для этого вы можете передавать пользовательские моки в экземпляр Vue.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>

<span class="token keyword">const</span> $route <span class="token operator">=</span> <span class="token punctuation">{</span>
  path<span class="token punctuation">:</span> <span class="token string">'/some/path'</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Component<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  mocks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    $route
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$route<span class="token punctuation">.</span>path <span class="token comment">// /some/path</span>
</code></pre></div><h3 id="известные-подводные-камни"><a href="#известные-подводные-камни" class="header-anchor">#</a> Известные подводные камни</h3> <p>Установка Vue Router добавляет <code>$route</code> и <code>$router</code> в качестве свойств только для чтения на прототипе Vue.</p> <p>Это означает, что любые будущие тесты, которые попытаются сделать мок <code>$route</code> или <code>$router</code> потерпят неудачу.</p> <p>Для избежания этого никогда не устанавливайте Vue Router глобально при запуске тестов; используйте localVue как было показано выше.</p> <h1 id="испоnьзование-с-vuex"><a href="#испоnьзование-с-vuex" class="header-anchor">#</a> Использование с Vuex</h1> <p>В этом руководстве мы рассмотрим как тестировать Vuex в компонентах с Vue Test Utils и как подходить к тестированию хранилища Vuex.</p> <h2 id="тестирование-vuex-в-компонентах"><a href="#тестирование-vuex-в-компонентах" class="header-anchor">#</a> Тестирование Vuex в компонентах</h2> <h3 id="создание-моков-дnя-действий"><a href="#создание-моков-дnя-действий" class="header-anchor">#</a> Создание моков для действий</h3> <p>Давайте посмотрим на часть кода.</p> <p>Это компонент который мы хотим протестировать. Он вызывает действие Vuex.</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text-align-center<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>actionInputIfTrue<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>actionClick()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Нажми<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> mapActions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'actionClick'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function-variable function">actionInputIfTrue</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token function">actionInputIfTrue</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> inputValue <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
        <span class="token keyword">if</span> <span class="token punctuation">(</span>inputValue <span class="token operator">===</span> <span class="token string">'input'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'actionInput'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> inputValue <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Для целей этого теста нам всё равно, что делает действие или как выглядит структура хранилища. Мы должны просто узнать, что это действие вызывается когда должно, и что оно вызывается с ожидаемым значением.</p> <p>Чтобы протестировать это, нам нужно передать мок хранилища в Vue, когда мы отделяем наш компонент.</p> <p>Вместо передачи хранилища в базовый конструктор Vue, мы можем передать его в <a href="/ru/api/options.html#localvue">localVue</a>. localVue — это изолированный конструктор Vue, в который мы можем вносить изменения без влияния на глобальный конструктор Vue.</p> <p>Давайте посмотрим, как это выглядит:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount<span class="token punctuation">,</span> createLocalVue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>
<span class="token keyword">import</span> Actions <span class="token keyword">from</span> <span class="token string">'../../../src/components/Actions'</span>

<span class="token keyword">const</span> localVue <span class="token operator">=</span> <span class="token function">createLocalVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

localVue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Actions.vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> actions
  <span class="token keyword">let</span> store

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    actions <span class="token operator">=</span> <span class="token punctuation">{</span>
      actionClick<span class="token punctuation">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      actionInput<span class="token punctuation">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      actions
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'вызывает &quot;actionInput&quot;, когда значение события — &quot;input&quot;'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Actions<span class="token punctuation">,</span> <span class="token punctuation">{</span> store<span class="token punctuation">,</span> localVue <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> input <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span>
    input<span class="token punctuation">.</span>element<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'input'</span>
    input<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span>actionInput<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'не вызывает &quot;actionInput&quot;, когда значение события не &quot;input&quot;'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Actions<span class="token punctuation">,</span> <span class="token punctuation">{</span> store<span class="token punctuation">,</span> localVue <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> input <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span>
    input<span class="token punctuation">.</span>element<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'not input'</span>
    input<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span>actionInput<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'вызывает действие хранилища &quot;actionClick&quot; по нажатию кнопки'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Actions<span class="token punctuation">,</span> <span class="token punctuation">{</span> store<span class="token punctuation">,</span> localVue <span class="token punctuation">}</span><span class="token punctuation">)</span>
    wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span>actionClick<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Что тут происходит? Сначала мы указываем Vue использовать Vuex с помощью метода <code>localVue.use</code>. Это всего лишь обёртка вокруг <code>Vue.use</code>.</p> <p>Затем мы создаём мок хранилища вызовом <code>new Vuex.store</code> с нашими заготовленными значениями. Мы передаём ему только действия, так как это всё, что нам необходимо.</p> <p>Действия реализуются с помощью <a href="https://jestjs.io/docs/en/mock-functions.html" target="_blank" rel="noopener noreferrer">mock-функций jest<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Эти mock-функции предоставляют нам методы для проверки, вызывались ли действия или нет.</p> <p>Затем мы можем проверить в наших тестах, что заглушка действия была вызвана когда ожидалось.</p> <p>Теперь способ, которым мы определяем наше хранилище выглядит немного необычным для вас.</p> <p>Мы используем <code>beforeEach</code>, чтобы убедиться, что у нас есть чистое хранилище перед каждым тестом. <code>beforeEach</code> — это хук в mocha, который вызывается перед каждым тестом. В нашем тесте мы переназначаем значения переменных хранилища. Если бы мы этого не сделали, mock-функции нужно было бы автоматически сбрасывать. Это также позволяет нам изменять состояние в наших тестах, не влияя на последующие тесты.</p> <p>Самое важно, что следует отметить в этом тесте — то что <strong>мы создаём мок хранилища Vuex и затем передаём его в <code>vue-test-utils</code></strong>.</p> <p>Отлично, теперь мы можем создавать моки действий, давайте посмотрим на создание моков для геттеров.</p> <h3 id="создание-моков-дnя-геттеров"><a href="#создание-моков-дnя-геттеров" class="header-anchor">#</a> Создание моков для геттеров</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>inputValue<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{inputValue}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>clicks<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{clicks}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> mapGetters <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    computed<span class="token punctuation">:</span> <span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'clicks'</span><span class="token punctuation">,</span> <span class="token string">'inputValue'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Это довольно простой компонент. Он отображает результат геттеров <code>clicks</code> и <code>inputValue</code>. Опять же, нас не волнует что возвращают эти геттеры — только то, что их результат будет корректно отображён.</p> <p>Давайте посмотрим на тест:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount<span class="token punctuation">,</span> createLocalVue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>
<span class="token keyword">import</span> Getters <span class="token keyword">from</span> <span class="token string">'../../../src/components/Getters'</span>

<span class="token keyword">const</span> localVue <span class="token operator">=</span> <span class="token function">createLocalVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

localVue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Getters.vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> getters
  <span class="token keyword">let</span> store

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    getters <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">clicks</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token function-variable function">inputValue</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">'input'</span>
    <span class="token punctuation">}</span>

    store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      getters
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Отображает &quot;state.inputValue&quot; в первом теге p'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Getters<span class="token punctuation">,</span> <span class="token punctuation">{</span> store<span class="token punctuation">,</span> localVue <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> p <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>getters<span class="token punctuation">.</span><span class="token function">inputValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Отображает &quot;state.clicks&quot; во втором теге p'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Getters<span class="token punctuation">,</span> <span class="token punctuation">{</span> store<span class="token punctuation">,</span> localVue <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> p <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>getters<span class="token punctuation">.</span><span class="token function">clicks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Этот тест очень похож на тест действий. Мы создаём мок хранилища перед каждым тестом, передаём его в качестве опции когда вызываем <code>shallowMount</code>, и проверяем что значение вернувшееся из мока-геттера отображается.</p> <p>Это здорово, но что, если мы хотим проверить, что наши геттеры возвращают корректную часть нашего состояния?</p> <h3 id="создание-моков-с-модуnями"><a href="#создание-моков-с-модуnями" class="header-anchor">#</a> Создание моков с модулями</h3> <p><a href="https://vuex.vuejs.org/ru/guide/modules.html" target="_blank" rel="noopener noreferrer">Модули<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> полезны для разделения нашего хранилища на управляемые части. Они также экспортируют геттеры. Мы можем использовать их в наших тестах.</p> <p>Давайте взглянем на наш компонент:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>moduleActionClick()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Нажми<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{moduleClicks}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> mapActions<span class="token punctuation">,</span> mapGetters <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'moduleActionClick'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    computed<span class="token punctuation">:</span> <span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'moduleClicks'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Простой компонент, который содержит одно действие и один геттер.</p> <p>И тест:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount<span class="token punctuation">,</span> createLocalVue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>
<span class="token keyword">import</span> MyComponent <span class="token keyword">from</span> <span class="token string">'../../../src/components/MyComponent'</span>
<span class="token keyword">import</span> myModule <span class="token keyword">from</span> <span class="token string">'../../../src/store/myModule'</span>

<span class="token keyword">const</span> localVue <span class="token operator">=</span> <span class="token function">createLocalVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

localVue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'MyComponent.vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> actions
  <span class="token keyword">let</span> state
  <span class="token keyword">let</span> store

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state <span class="token operator">=</span> <span class="token punctuation">{</span>
      clicks<span class="token punctuation">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>

    actions <span class="token operator">=</span> <span class="token punctuation">{</span>
      moduleActionClick<span class="token punctuation">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      modules<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        myModule<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          state<span class="token punctuation">,</span>
          actions<span class="token punctuation">,</span>
          getters<span class="token punctuation">:</span> myModule<span class="token punctuation">.</span>getters
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'вызывает действие &quot;moduleActionClick&quot; при нажатии кнопки'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">,</span> <span class="token punctuation">{</span> store<span class="token punctuation">,</span> localVue <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> button <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span>
    button<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span>moduleActionClick<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'отображает &quot;state.inputValue&quot; в первом теге p'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">,</span> <span class="token punctuation">{</span> store<span class="token punctuation">,</span> localVue <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> p <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>clicks<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="тестирование-храниnища-vuex"><a href="#тестирование-храниnища-vuex" class="header-anchor">#</a> Тестирование хранилища Vuex</h3> <p>Существуют два подхода к тестированию хранилища Vuex. Первый подход заключается в модульном тестировании геттеров, изменений и действий отдельно. Второй подход — создать хранилище и протестировать его. Мы рассмотрим оба подхода.</p> <p>Чтобы понять, как протестировать хранилище Vuex, мы создадим простое хранилище-счётчик. В хранилище есть мутация <code>increment</code> и геттер <code>evenOrOdd</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// mutations.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">increment</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>count<span class="token operator">++</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// getters.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">evenOrOdd</span><span class="token punctuation">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>count <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">'even'</span> <span class="token punctuation">:</span> <span class="token string">'odd'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="тестирование-геттеров-мутаций-и-действий-отдеnьно"><a href="#тестирование-геттеров-мутаций-и-действий-отдеnьно" class="header-anchor">#</a> Тестирование геттеров, мутаций и действий отдельно</h3> <p>Геттеры, мутации и действия — JavaScript-функции, поэтому мы можем протестировать их без использования Vue Test Utils и Vuex.</p> <p>Преимущество тестирования геттеров, мутаций и действий по отдельности заключается в том, как ваши модульные тесты подробно описаны. Когда они терпят неудачу, вы точно знаете, что не так с вашим кодом. Недостатком является то, что вы нужны моки функций Vuex, таких как <code>commit</code> и <code>dispatch</code>. Это может привести к ситуации, когда модульные тесты проходят, но production-код терпит неудачу, потому что моки некорректные.</p> <p>Мы создадим два тестовых файла: <code>mutations.spec.js</code> и <code>getters.spec.js</code>:</p> <p>Сначала давайте протестируем мутации <code>increment</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// mutations.spec.js</span>

<span class="token keyword">import</span> mutations <span class="token keyword">from</span> <span class="token string">'./mutations'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'мутация &quot;increment&quot; увеличивает &quot;state.count&quot; на 1'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
    count<span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
  mutations<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Теперь давайте протестируем геттер <code>evenOrOdd</code>. Мы можем протестировать его, путём создания мока для <code>state</code>, вызвав геттер с <code>state</code> и проверкой, что возвращается корректное значение.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// getters.spec.js</span>

<span class="token keyword">import</span> getters <span class="token keyword">from</span> <span class="token string">'./getters'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'evenOrOdd возвращает even, если в state.count находится even'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
    count<span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token punctuation">}</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>getters<span class="token punctuation">.</span><span class="token function">evenOrOdd</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'even'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'evenOrOdd возвращает odd, если в state.count находится odd'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
    count<span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>getters<span class="token punctuation">.</span><span class="token function">evenOrOdd</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'odd'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="тестирование-запущенного-храниnища"><a href="#тестирование-запущенного-храниnища" class="header-anchor">#</a> Тестирование запущенного хранилища</h3> <p>Другой подход к тестированию хранилища Vuex — это создание запущенного хранилища с использованием конфигурации хранилища.</p> <p>Преимущество тестирования создания экземпляра запущенного хранилища заключается в том,что нам не нужны моки для функций Vuex.</p> <p>Недостатком является то, что если тест ломается, может быть трудно найти, в чём проблема.</p> <p>Давайте напишем тест. Когда мы создаём, мы будем использовать <code>localVue</code>, чтобы избежать загрязнения базового конструктора Vue. Тест создаёт хранилище, используя экспорт <code>store-config.js</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// store-config.js</span>

<span class="token keyword">import</span> mutations <span class="token keyword">from</span> <span class="token string">'./mutations'</span>
<span class="token keyword">import</span> getters <span class="token keyword">from</span> <span class="token string">'./getters'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    count<span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mutations<span class="token punctuation">,</span>
  getters
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// store-config.spec.js</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> createLocalVue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>
<span class="token keyword">import</span> storeConfig <span class="token keyword">from</span> <span class="token string">'./store-config'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> cloneDeep <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lodash'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'инкрементирует значение счётчика, когда происходит инкремент'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> localVue <span class="token operator">=</span> <span class="token function">createLocalVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  localVue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>
  <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token function">cloneDeep</span><span class="token punctuation">(</span>storeConfig<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'обновляет геттер evenOrOdd, когда происходит инкремент'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> localVue <span class="token operator">=</span> <span class="token function">createLocalVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  localVue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>
  <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token function">cloneDeep</span><span class="token punctuation">(</span>storeConfig<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>evenOrOdd<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'even'</span><span class="token punctuation">)</span>
  store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>evenOrOdd<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'odd'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Обратите внимание, что мы используем <code>cloneDeep</code> для клонирования конфигурации хранилища перед созданием хранилища с ним. Это связано с тем, что Vuex мутирует объект с опциями, используемый для создания хранилища. Чтобы убедиться, у нас есть пустое хранилище в каждом тесте, нам нужно клонировать объект <code>storeConfig</code>.</p> <h3 id="ресурсы-4"><a href="#ресурсы-4" class="header-anchor">#</a> Ресурсы</h3> <ul><li><a href="https://github.com/eddyerburgh/vue-test-utils-vuex-example" target="_blank" rel="noopener noreferrer">Пример проекта тестирования компонентов<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/eddyerburgh/testing-vuex-store-example" target="_blank" rel="noopener noreferrer">Пример проекта тестирования хранилища<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="/ru/api/options.html#localvue"><code>localVue</code></a></li> <li><a href="/ru/api/createLocalVue.html"><code>createLocalVue</code></a></li></ul></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/vuejs/vue-test-utils/edit/dev/docs/ru/guides/README.md" target="_blank" rel="noopener noreferrer">Изменить эту страницу на GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/ru/" class="prev router-link-active">
          Введение
        </a></span> <span class="next"><a href="/ru/api/">
          API
        </a>
        →
      </span></p></div> <div class="bsa-cpc-wrapper"><div class="bsa-cpc"></div></div></div> <!----></div></div>
    <script src="/assets/js/app.1329aa21.js" defer></script><script src="/assets/js/189.0798f541.js" defer></script>
  </body>
</html>
