<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ガイド | Vue Test Utils</title>
    <meta name="description" content="Vue コンポーネントをテストするためのユーティリティ">
    <link rel="icon" href="/favicon.png">
    
    <link rel="preload" href="/assets/css/0.styles.6fddc57d.css" as="style"><link rel="preload" href="/assets/js/app.1329aa21.js" as="script"><link rel="preload" href="/assets/js/124.8058bc12.js" as="script"><link rel="prefetch" href="/assets/js/10.29680c27.js"><link rel="prefetch" href="/assets/js/100.04f6aa34.js"><link rel="prefetch" href="/assets/js/101.0faed46e.js"><link rel="prefetch" href="/assets/js/102.5adbd4f8.js"><link rel="prefetch" href="/assets/js/103.ab03605d.js"><link rel="prefetch" href="/assets/js/104.853529ed.js"><link rel="prefetch" href="/assets/js/105.894916b1.js"><link rel="prefetch" href="/assets/js/106.15048092.js"><link rel="prefetch" href="/assets/js/107.75338401.js"><link rel="prefetch" href="/assets/js/108.380e49c8.js"><link rel="prefetch" href="/assets/js/109.eff80191.js"><link rel="prefetch" href="/assets/js/11.48ee5d3b.js"><link rel="prefetch" href="/assets/js/110.c8a76652.js"><link rel="prefetch" href="/assets/js/111.5ea0f65d.js"><link rel="prefetch" href="/assets/js/112.4ad98b3d.js"><link rel="prefetch" href="/assets/js/113.ecaf59db.js"><link rel="prefetch" href="/assets/js/114.d0f18bce.js"><link rel="prefetch" href="/assets/js/115.325a0839.js"><link rel="prefetch" href="/assets/js/116.3ad73770.js"><link rel="prefetch" href="/assets/js/117.4e280aa7.js"><link rel="prefetch" href="/assets/js/118.b4efe52b.js"><link rel="prefetch" href="/assets/js/119.9ab9e340.js"><link rel="prefetch" href="/assets/js/12.38da1e11.js"><link rel="prefetch" href="/assets/js/120.e2fb2daa.js"><link rel="prefetch" href="/assets/js/121.6f844508.js"><link rel="prefetch" href="/assets/js/122.ff2feb8e.js"><link rel="prefetch" href="/assets/js/123.9654b63b.js"><link rel="prefetch" href="/assets/js/125.15ac88b0.js"><link rel="prefetch" href="/assets/js/126.4919d1ce.js"><link rel="prefetch" href="/assets/js/127.ba415b0c.js"><link rel="prefetch" href="/assets/js/128.3b5a1f15.js"><link rel="prefetch" href="/assets/js/129.08fff316.js"><link rel="prefetch" href="/assets/js/13.2467e4d3.js"><link rel="prefetch" href="/assets/js/130.6177b120.js"><link rel="prefetch" href="/assets/js/131.3662683e.js"><link rel="prefetch" href="/assets/js/132.0a99c1ca.js"><link rel="prefetch" href="/assets/js/133.57ac58f3.js"><link rel="prefetch" href="/assets/js/134.68205139.js"><link rel="prefetch" href="/assets/js/135.62d0a716.js"><link rel="prefetch" href="/assets/js/136.1ba9fe2b.js"><link rel="prefetch" href="/assets/js/137.c002612a.js"><link rel="prefetch" href="/assets/js/138.104f9872.js"><link rel="prefetch" href="/assets/js/139.9937ea4d.js"><link rel="prefetch" href="/assets/js/14.09d9e43c.js"><link rel="prefetch" href="/assets/js/140.fc69423e.js"><link rel="prefetch" href="/assets/js/141.4278b1d2.js"><link rel="prefetch" href="/assets/js/142.02f17f28.js"><link rel="prefetch" href="/assets/js/143.edc98244.js"><link rel="prefetch" href="/assets/js/144.84ff6903.js"><link rel="prefetch" href="/assets/js/145.c4300d0b.js"><link rel="prefetch" href="/assets/js/146.97b8c42b.js"><link rel="prefetch" href="/assets/js/147.b45db334.js"><link rel="prefetch" href="/assets/js/148.29cc9dac.js"><link rel="prefetch" href="/assets/js/149.20083aaa.js"><link rel="prefetch" href="/assets/js/15.768aa9d0.js"><link rel="prefetch" href="/assets/js/150.5ffb1fda.js"><link rel="prefetch" href="/assets/js/151.0ef482d4.js"><link rel="prefetch" href="/assets/js/152.a7b342f2.js"><link rel="prefetch" href="/assets/js/153.d66cadd0.js"><link rel="prefetch" href="/assets/js/154.cf1b0ac0.js"><link rel="prefetch" href="/assets/js/155.17b5e561.js"><link rel="prefetch" href="/assets/js/156.baf08bf3.js"><link rel="prefetch" href="/assets/js/157.d4ada28a.js"><link rel="prefetch" href="/assets/js/158.ebb753a6.js"><link rel="prefetch" href="/assets/js/159.91678ded.js"><link rel="prefetch" href="/assets/js/16.5bdeee2c.js"><link rel="prefetch" href="/assets/js/160.acc3bfd8.js"><link rel="prefetch" href="/assets/js/161.b80960b6.js"><link rel="prefetch" href="/assets/js/162.5309d0c0.js"><link rel="prefetch" href="/assets/js/163.1f1af0fa.js"><link rel="prefetch" href="/assets/js/164.9aa31800.js"><link rel="prefetch" href="/assets/js/165.67089a2d.js"><link rel="prefetch" href="/assets/js/166.e4381a59.js"><link rel="prefetch" href="/assets/js/167.e061b4be.js"><link rel="prefetch" href="/assets/js/168.1622ee8d.js"><link rel="prefetch" href="/assets/js/169.a74fa5ec.js"><link rel="prefetch" href="/assets/js/17.6a9184c3.js"><link rel="prefetch" href="/assets/js/170.dbcbf8ff.js"><link rel="prefetch" href="/assets/js/171.a3b8a4f9.js"><link rel="prefetch" href="/assets/js/172.de198904.js"><link rel="prefetch" href="/assets/js/173.3fd7eba4.js"><link rel="prefetch" href="/assets/js/174.125158bf.js"><link rel="prefetch" href="/assets/js/175.5773a31e.js"><link rel="prefetch" href="/assets/js/176.fcbaf7d1.js"><link rel="prefetch" href="/assets/js/177.e13c54ed.js"><link rel="prefetch" href="/assets/js/178.461c97de.js"><link rel="prefetch" href="/assets/js/179.18556f26.js"><link rel="prefetch" href="/assets/js/18.4739f596.js"><link rel="prefetch" href="/assets/js/180.d8162130.js"><link rel="prefetch" href="/assets/js/181.3e030696.js"><link rel="prefetch" href="/assets/js/182.0d333584.js"><link rel="prefetch" href="/assets/js/183.2c46f0c1.js"><link rel="prefetch" href="/assets/js/184.59f17e66.js"><link rel="prefetch" href="/assets/js/185.7925ce4a.js"><link rel="prefetch" href="/assets/js/186.3acf0daf.js"><link rel="prefetch" href="/assets/js/187.96e6dcdd.js"><link rel="prefetch" href="/assets/js/188.8cf3b309.js"><link rel="prefetch" href="/assets/js/189.0798f541.js"><link rel="prefetch" href="/assets/js/19.30d0c826.js"><link rel="prefetch" href="/assets/js/190.66cb08eb.js"><link rel="prefetch" href="/assets/js/191.452d56c4.js"><link rel="prefetch" href="/assets/js/192.65b42183.js"><link rel="prefetch" href="/assets/js/193.702243fe.js"><link rel="prefetch" href="/assets/js/194.cc073482.js"><link rel="prefetch" href="/assets/js/195.48a7245e.js"><link rel="prefetch" href="/assets/js/196.feae8953.js"><link rel="prefetch" href="/assets/js/197.70d94a78.js"><link rel="prefetch" href="/assets/js/198.99f9b3d3.js"><link rel="prefetch" href="/assets/js/199.d88b8456.js"><link rel="prefetch" href="/assets/js/20.8c56e86c.js"><link rel="prefetch" href="/assets/js/200.80ba7b94.js"><link rel="prefetch" href="/assets/js/201.aad9c773.js"><link rel="prefetch" href="/assets/js/202.3402b8a7.js"><link rel="prefetch" href="/assets/js/203.8a011962.js"><link rel="prefetch" href="/assets/js/204.db458acf.js"><link rel="prefetch" href="/assets/js/205.f88837dd.js"><link rel="prefetch" href="/assets/js/206.97b6ee18.js"><link rel="prefetch" href="/assets/js/207.2175c20a.js"><link rel="prefetch" href="/assets/js/208.4d4fc400.js"><link rel="prefetch" href="/assets/js/209.2b8f6d9c.js"><link rel="prefetch" href="/assets/js/21.b1fca836.js"><link rel="prefetch" href="/assets/js/210.9fbe7e4f.js"><link rel="prefetch" href="/assets/js/211.b9d49f94.js"><link rel="prefetch" href="/assets/js/212.03bddb3f.js"><link rel="prefetch" href="/assets/js/213.ce98d5fc.js"><link rel="prefetch" href="/assets/js/214.dc7073f3.js"><link rel="prefetch" href="/assets/js/215.2afd5e1e.js"><link rel="prefetch" href="/assets/js/216.544b7ade.js"><link rel="prefetch" href="/assets/js/217.b067af8d.js"><link rel="prefetch" href="/assets/js/218.377bede2.js"><link rel="prefetch" href="/assets/js/219.27f6f18c.js"><link rel="prefetch" href="/assets/js/22.092854f5.js"><link rel="prefetch" href="/assets/js/220.68ba890e.js"><link rel="prefetch" href="/assets/js/221.ff994cf8.js"><link rel="prefetch" href="/assets/js/222.3c530c59.js"><link rel="prefetch" href="/assets/js/223.543c93de.js"><link rel="prefetch" href="/assets/js/224.134c6c7a.js"><link rel="prefetch" href="/assets/js/225.674555de.js"><link rel="prefetch" href="/assets/js/226.fec2925b.js"><link rel="prefetch" href="/assets/js/227.10c8d245.js"><link rel="prefetch" href="/assets/js/228.fd07045c.js"><link rel="prefetch" href="/assets/js/229.c0feb073.js"><link rel="prefetch" href="/assets/js/23.d845f6d8.js"><link rel="prefetch" href="/assets/js/230.2e0a02ff.js"><link rel="prefetch" href="/assets/js/231.3a77efd5.js"><link rel="prefetch" href="/assets/js/232.b5bbcb42.js"><link rel="prefetch" href="/assets/js/233.cc853042.js"><link rel="prefetch" href="/assets/js/234.757ff651.js"><link rel="prefetch" href="/assets/js/235.660cc45c.js"><link rel="prefetch" href="/assets/js/236.98ccd76a.js"><link rel="prefetch" href="/assets/js/237.b04def99.js"><link rel="prefetch" href="/assets/js/238.b4d318e6.js"><link rel="prefetch" href="/assets/js/239.449c536e.js"><link rel="prefetch" href="/assets/js/24.a1fa948d.js"><link rel="prefetch" href="/assets/js/240.57ff4221.js"><link rel="prefetch" href="/assets/js/241.1bd6a846.js"><link rel="prefetch" href="/assets/js/242.d95c91dc.js"><link rel="prefetch" href="/assets/js/243.1e6f8aac.js"><link rel="prefetch" href="/assets/js/244.2c4a8646.js"><link rel="prefetch" href="/assets/js/245.afaa20c3.js"><link rel="prefetch" href="/assets/js/246.16616268.js"><link rel="prefetch" href="/assets/js/247.3406b39c.js"><link rel="prefetch" href="/assets/js/248.165a9d74.js"><link rel="prefetch" href="/assets/js/249.1e4e5921.js"><link rel="prefetch" href="/assets/js/25.b335f886.js"><link rel="prefetch" href="/assets/js/250.0a4a23a1.js"><link rel="prefetch" href="/assets/js/251.6e59411b.js"><link rel="prefetch" href="/assets/js/252.f77513bf.js"><link rel="prefetch" href="/assets/js/253.dc28afed.js"><link rel="prefetch" href="/assets/js/254.5765c3f9.js"><link rel="prefetch" href="/assets/js/255.6808c117.js"><link rel="prefetch" href="/assets/js/256.16f7d2c3.js"><link rel="prefetch" href="/assets/js/257.68e09d25.js"><link rel="prefetch" href="/assets/js/258.f03f1c22.js"><link rel="prefetch" href="/assets/js/259.62ed35af.js"><link rel="prefetch" href="/assets/js/26.0b12b1d4.js"><link rel="prefetch" href="/assets/js/260.ef39b24c.js"><link rel="prefetch" href="/assets/js/261.71e6f0db.js"><link rel="prefetch" href="/assets/js/262.bf234e8c.js"><link rel="prefetch" href="/assets/js/263.e3630155.js"><link rel="prefetch" href="/assets/js/264.04e2bcb8.js"><link rel="prefetch" href="/assets/js/265.6f4e18ce.js"><link rel="prefetch" href="/assets/js/266.aeb06326.js"><link rel="prefetch" href="/assets/js/27.bbed2698.js"><link rel="prefetch" href="/assets/js/28.b7b0808e.js"><link rel="prefetch" href="/assets/js/29.8643a805.js"><link rel="prefetch" href="/assets/js/3.ba802fc9.js"><link rel="prefetch" href="/assets/js/30.bb145cc6.js"><link rel="prefetch" href="/assets/js/31.b82c119c.js"><link rel="prefetch" href="/assets/js/32.3ebc8ac8.js"><link rel="prefetch" href="/assets/js/33.5a4570f6.js"><link rel="prefetch" href="/assets/js/34.a2c4b2ad.js"><link rel="prefetch" href="/assets/js/35.e424a17b.js"><link rel="prefetch" href="/assets/js/36.bcf7d6d3.js"><link rel="prefetch" href="/assets/js/37.87610ef6.js"><link rel="prefetch" href="/assets/js/38.63a687c1.js"><link rel="prefetch" href="/assets/js/39.6fe142e4.js"><link rel="prefetch" href="/assets/js/4.1e032f20.js"><link rel="prefetch" href="/assets/js/40.b931ff87.js"><link rel="prefetch" href="/assets/js/41.94fdb234.js"><link rel="prefetch" href="/assets/js/42.85378732.js"><link rel="prefetch" href="/assets/js/43.13a9295c.js"><link rel="prefetch" href="/assets/js/44.3228b04d.js"><link rel="prefetch" href="/assets/js/45.66a222b7.js"><link rel="prefetch" href="/assets/js/46.0c596ee2.js"><link rel="prefetch" href="/assets/js/47.50770cc8.js"><link rel="prefetch" href="/assets/js/48.56dce17d.js"><link rel="prefetch" href="/assets/js/49.a76a2cbb.js"><link rel="prefetch" href="/assets/js/5.68d5f562.js"><link rel="prefetch" href="/assets/js/50.11b83e09.js"><link rel="prefetch" href="/assets/js/51.b52ef253.js"><link rel="prefetch" href="/assets/js/52.032204ec.js"><link rel="prefetch" href="/assets/js/53.83cc7c06.js"><link rel="prefetch" href="/assets/js/54.0405a748.js"><link rel="prefetch" href="/assets/js/55.6b40fabe.js"><link rel="prefetch" href="/assets/js/56.6d6eeae4.js"><link rel="prefetch" href="/assets/js/57.27a5e368.js"><link rel="prefetch" href="/assets/js/58.7b7fc153.js"><link rel="prefetch" href="/assets/js/59.4fc050dd.js"><link rel="prefetch" href="/assets/js/6.628b9f9a.js"><link rel="prefetch" href="/assets/js/60.64dab6ba.js"><link rel="prefetch" href="/assets/js/61.fb115e71.js"><link rel="prefetch" href="/assets/js/62.19be661f.js"><link rel="prefetch" href="/assets/js/63.b50bec8c.js"><link rel="prefetch" href="/assets/js/64.4abe7d11.js"><link rel="prefetch" href="/assets/js/65.727de1b7.js"><link rel="prefetch" href="/assets/js/66.6500f2d0.js"><link rel="prefetch" href="/assets/js/67.4911332d.js"><link rel="prefetch" href="/assets/js/68.e7d2b80e.js"><link rel="prefetch" href="/assets/js/69.8b364c08.js"><link rel="prefetch" href="/assets/js/7.2381a9a5.js"><link rel="prefetch" href="/assets/js/70.bf129352.js"><link rel="prefetch" href="/assets/js/71.d62c85bf.js"><link rel="prefetch" href="/assets/js/72.685c7c67.js"><link rel="prefetch" href="/assets/js/73.bd9225b9.js"><link rel="prefetch" href="/assets/js/74.d0e63c75.js"><link rel="prefetch" href="/assets/js/75.ac1516c8.js"><link rel="prefetch" href="/assets/js/76.a76672e2.js"><link rel="prefetch" href="/assets/js/77.7fa90e9a.js"><link rel="prefetch" href="/assets/js/78.b27852cd.js"><link rel="prefetch" href="/assets/js/79.9964f1bb.js"><link rel="prefetch" href="/assets/js/8.a0f2028d.js"><link rel="prefetch" href="/assets/js/80.e831bc7f.js"><link rel="prefetch" href="/assets/js/81.f4adc35d.js"><link rel="prefetch" href="/assets/js/82.79dc5f2d.js"><link rel="prefetch" href="/assets/js/83.a42f5133.js"><link rel="prefetch" href="/assets/js/84.8c6c443a.js"><link rel="prefetch" href="/assets/js/85.c036fe47.js"><link rel="prefetch" href="/assets/js/86.253e8f74.js"><link rel="prefetch" href="/assets/js/87.4765a9dc.js"><link rel="prefetch" href="/assets/js/88.fd60117d.js"><link rel="prefetch" href="/assets/js/89.6a7b741f.js"><link rel="prefetch" href="/assets/js/9.18ef8d1c.js"><link rel="prefetch" href="/assets/js/90.5df03d9e.js"><link rel="prefetch" href="/assets/js/91.edc99526.js"><link rel="prefetch" href="/assets/js/92.a9aaf7f6.js"><link rel="prefetch" href="/assets/js/93.b5488e19.js"><link rel="prefetch" href="/assets/js/94.90c0b724.js"><link rel="prefetch" href="/assets/js/95.96685ca5.js"><link rel="prefetch" href="/assets/js/96.dfd1b877.js"><link rel="prefetch" href="/assets/js/97.4312b650.js"><link rel="prefetch" href="/assets/js/98.6b7e7ac0.js"><link rel="prefetch" href="/assets/js/99.c1f5db36.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.4cd972f0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6fddc57d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/ja/" class="home-link router-link-active"><!----> <span class="site-name">Vue Test Utils</span></a> <div class="links" style="max-width:nullpx;"><form id="search-form" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/ja/api/" class="nav-link">API</a></div><div class="nav-item"><a href="/ja/guides/" class="nav-link router-link-exact-active router-link-active">ガイド</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">言語</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guides/" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/ja/guides/" class="nav-link router-link-exact-active router-link-active">日本語</a></li><li class="dropdown-item"><!----> <a href="/zh/guides/" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/ru/guides/" class="nav-link">Русский</a></li></ul></div></div> <a href="https://github.com/vuejs/vue-test-utils" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/ja/api/" class="nav-link">API</a></div><div class="nav-item"><a href="/ja/guides/" class="nav-link router-link-exact-active router-link-active">ガイド</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">言語</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guides/" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/ja/guides/" class="nav-link router-link-exact-active router-link-active">日本語</a></li><li class="dropdown-item"><!----> <a href="/zh/guides/" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/ru/guides/" class="nav-link">Русский</a></li></ul></div></div> <a href="https://github.com/vuejs/vue-test-utils" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav> <div class="carbon-ads"></div> <ul class="sidebar-links"><li><a href="/ja/" class="sidebar-link">vue-test-utils</a></li><li><a href="/ja/guides/" class="active sidebar-link">ガイド</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ja/guides/#はじめる" class="sidebar-link">はじめる</a></li><li class="sidebar-sub-header"><a href="/ja/guides/#一般的なヒント" class="sidebar-link">一般的なヒント</a></li><li class="sidebar-sub-header"><a href="/ja/guides/#テストランナを選ぶ" class="sidebar-link">テストランナを選ぶ</a></li><li class="sidebar-sub-header"><a href="/ja/guides/#jest-を使用した単一ファイルコンポーネントのテスト" class="sidebar-link">Jest を使用した単一ファイルコンポーネントのテスト</a></li><li class="sidebar-sub-header"><a href="/ja/guides/#karma-による単一ファイルコンポーネントのテスト" class="sidebar-link">Karma による単一ファイルコンポーネントのテスト</a></li><li class="sidebar-sub-header"><a href="/ja/guides/#非同期動作のテスト" class="sidebar-link">非同期動作のテスト</a></li><li class="sidebar-sub-header"><a href="/ja/guides/#typescript-と一緒に使う" class="sidebar-link">TypeScript と一緒に使う</a></li><li class="sidebar-sub-header"><a href="/ja/guides/#コンポーネント内の-vuex-をテストする" class="sidebar-link">コンポーネント内の Vuex をテストする</a></li></ul></li><li><a href="/ja/api/" class="sidebar-link">API</a></li><li><a href="/ja/api/wrapper/" class="sidebar-link">Wrapper</a></li><li><a href="/ja/api/wrapper-array/" class="sidebar-link">WrapperArray</a></li><li><a href="/ja/api/options.html" class="sidebar-link">マウンティングオプション</a></li><li><a href="/ja/api/components/" class="sidebar-link">コンポーネント</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="ガイド"><a href="#ガイド" class="header-anchor">#</a> ガイド</h1> <h2 id="はじめる"><a href="#はじめる" class="header-anchor">#</a> はじめる</h2> <h4 id="セットアップ"><a href="#セットアップ" class="header-anchor">#</a> セットアップ</h4> <p><code>vue-test-utils</code> の使い方を体験したい場合は、基本設定としてデモリポジトリをクローンし、依存関係をインストールしてください。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> clone https://github.com/vuejs/vue-test-utils-getting-started
<span class="token builtin class-name">cd</span> vue-test-utils-getting-started
<span class="token function">npm</span> <span class="token function">install</span>
</code></pre></div><p>プロジェクトには単純なコンポーネント、<code>counter.js</code> が含まれています。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// counter.js</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  template<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;div&gt;
      &lt;span class=&quot;count&quot;&gt;{{ count }}&lt;/span&gt;
      &lt;button @click=&quot;increment&quot;&gt;Increment&lt;/button&gt;
    &lt;/div&gt;
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>

  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      count<span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">++</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="マウンティングコンポーネント"><a href="#マウンティングコンポーネント" class="header-anchor">#</a> マウンティングコンポーネント</h3> <p><code>vue-test-utils</code> は Vue コンポーネントを隔離してマウントし、必要な入力(プロパティ、注入、そしてユーザイベント)をモックし、そして出力(描画結果、カスタムイベントの発行)を検証することでテストします。</p> <p>マウントされたコンポーネントは <a href="/ja/api/wrapper/">Wrapper</a> の内部に返されます。これは、基の Vue コンポーネントインスタンスを操作、トラバース、クエリ処理するための多くの便利なメソッドを公開しています。</p> <p><code>mount</code> メソッドを使ってラッパを作成することができます。<code>test.js</code> というファイルを作りましょう:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// test.js</span>

<span class="token comment">// test utils から mount() メソッドをインポート</span>
<span class="token comment">// テストするコンポーネント</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">'./counter'</span>

<span class="token comment">// コンポーネントがマウントされ、ラッパが作成されます。</span>
<span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span>

<span class="token comment">// wrapper.vmを 介して実際の Vue インスタンスにアクセスできます</span>
<span class="token keyword">const</span> vm <span class="token operator">=</span> wrapper<span class="token punctuation">.</span>vm

<span class="token comment">// ラッパをより深く調べるためにコンソールに記録してみましょう。</span>
<span class="token comment">// vue-test-utils でのあなたの冒険はここから始まります。</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span>
</code></pre></div><h3 id="コンポーネントの描画された-html-出力をテストする"><a href="#コンポーネントの描画された-html-出力をテストする" class="header-anchor">#</a> コンポーネントの描画された HTML 出力をテストする</h3> <p>ラッパが完成したので、コンポーネントの描画された HTML 出力が、期待されるものと一致することを確認します。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">'./counter'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Counter'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// コンポーネントがマウントされ、ラッパが作成されます。</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'renders the correct markup'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">'&lt;span class=&quot;count&quot;&gt;0&lt;/span&gt;'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 要素の存在を確認することも簡単です</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'has a button'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>次に、<code>npm test</code> でテストを実行します。テストが合格になるはずです。</p> <h3 id="ユーザのインタラクションをシミュレーションする"><a href="#ユーザのインタラクションをシミュレーションする" class="header-anchor">#</a> ユーザのインタラクションをシミュレーションする</h3> <p>ユーザがボタンをクリックすると、カウンタがカウントをインクリメントする必要があります。この振る舞いをシミュレートするには、まず<strong>button 要素のラッパ</strong>を返す <code>wrapper.find()</code> を使ってボタンを見つける必要があります。ボタンのラッパで <code>.trigger()</code> を呼び出すことでクリックをシミュレートできます:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'button click should increment the count'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> button <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span>
  button<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="nexttick-はどうですか"><a href="#nexttick-はどうですか" class="header-anchor">#</a> <code>nextTick</code> はどうですか?</h3> <p>Vue は保留した DOM 更新をまとめて処理し、非同期に適用して、複数のデータのミューテーションに起因する不要な再描画を防ぎます。実際には、Vue が何らかの状態変更をトリガした後に Vue が実際の DOM 更新を実行するまで待つために、<code>Vue.nextTick</code> を使用しなければならないからです。</p> <p>使い方を簡単にするため、 <code>vue-test-utils</code> はすべての更新を同期的に適用するので、テストで DOM を更新するために <code>Vue.nextTick</code> を使う必要はありません。</p> <p><em>注意: 非同期コールバックやプロミスの解決などの操作のために、イベントループを明示的に進める必要がある場合は、まだ <code>nextTick</code> が必要です。</em></p> <p>テストファイルで <code>nextTick</code> をまだ使う必要がある場合は、 <code>nextTick</code> の内部で Promise を使っているので、 <code>nextTick</code> 内で発生したエラーはテストランナーによって捕捉されないことに注意してください。これを解決するには 2 つの方法があります。 1 つ目はテストの最初で Vue のグローバルエラーハンドラに <code>done</code> コールバックをセットする方法です。2 つ目は <code>nextTick</code> を引数なしで実行して、それを Promise としてテストランナーに返す方法です。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// これは捕捉されない</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'will time out'</span><span class="token punctuation">,</span> <span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Vue<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 以下の2つのテストは期待通り動作します</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'will catch the error using done'</span><span class="token punctuation">,</span> <span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>errorHandler <span class="token operator">=</span> done
  Vue<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'will catch the error using a promise'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Vue<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="次は何をするのか"><a href="#次は何をするのか" class="header-anchor">#</a> 次は何をするのか</h3> <ul><li><a href="/ja/guides/choosing-a-test-runner.html">テストランナを選ぶ</a>で <code>vue-test-utils</code> をプロジェクトに組み込む</li> <li><a href="/ja/guides/common-tips.html">テストを書くときの一般的なヒント</a>についてもっと知る</li></ul> <h2 id="一般的なヒント"><a href="#一般的なヒント" class="header-anchor">#</a> 一般的なヒント</h2> <h3 id="何をテストするかを知る"><a href="#何をテストするかを知る" class="header-anchor">#</a> 何をテストするかを知る</h3> <p>UI コンポーネントでは、コンポーネントの内部実装の詳細に集中しすぎて脆弱なテストが発生する可能性があるため、完全なラインベースのカバレッジを目指すことはお勧めしません。</p> <p>代わりに、コンポーネントのパブリックインターフェイスを検証するテストを作成し、内部をブラックボックスとして扱うことをお勧めします。単一のテストケースでは、コンポーネントに提供された入力（ユーザーのやり取りやプロパティの変更）によって、期待される出力（結果の描画またはカスタムイベントの出力）が行われることが示されます。</p> <p>たとえば、ボタンがクリックされるたびに表示カウンタを 1 ずつインクリメントする <code>Counter</code> コンポーネントの場合、そのテストケースはクリックをシミュレートし、描画された出力が 1 つ増加したのか検証します。カウンタは値をインクリメントし、入力と出力のみを扱います。</p> <p>このアプローチの利点は、コンポーネントのパブリックインターフェイスが同じままである限り、コンポーネントの内部実装が時間の経過とともにどのように変化してもテストは合格になります。</p> <p>このトピックは、<a href="https://www.youtube.com/watch?v=OIpfWTThrK8" target="_blank" rel="noopener noreferrer">Matt O'Connell による偉大なプレゼンテーション<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>で詳細に説明されています。</p> <h3 id="shallow-描画"><a href="#shallow-描画" class="header-anchor">#</a> Shallow 描画</h3> <p>単体テストでは、通常、単体テストとしてテスト対象のコンポーネントに焦点を当て、子コンポーネントの動作を間接的に検証することを避けたいと考えています。</p> <p>さらに、多くの子コンポーネントを含むコンポーネントの場合、描画されたツリー全体が非常に大きくなる可能性があります。すべての子コンポーネントを繰り返し描画すると、テストが遅くなる可能性があります。</p> <p><code>vue-test-utils</code> を使うと、<code>shallowMount</code> メソッドを使って子コンポーネントを（スタブによって）描画せずにコンポーネントをマウントすることができます：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>

<span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Component<span class="token punctuation">)</span> <span class="token comment">// Component インスタンスを含む Wrapper を返します。</span>
wrapper<span class="token punctuation">.</span>vm <span class="token comment">// マウントされた Vue インスタンス</span>
</code></pre></div><h3 id="イベントの発行を検証する"><a href="#イベントの発行を検証する" class="header-anchor">#</a> イベントの発行を検証する</h3> <p>マウントされた各ラッパは、基になる Vue インスタンスによって発行されたすべてのイベントを自動的に記録します。<code>wrapper.emitted()</code> を使って、記録されたイベントを取り出すことができます:</p> <div class="language-js extra-class"><pre class="language-js"><code>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>
wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span>

<span class="token comment">/*
wrapper.emitted()は次のオブジェクトを返します:
{
  foo: [[], [123]]
}
*/</span>
</code></pre></div><p>次に、これらのデータに基づいて検証することもできます。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// イベントが発行されたか検証する</span>
<span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// イベント数を検証する</span>
<span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foo<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment">// イベントのペイロードを検証する</span>
<span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foo<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">123</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>また、<a href="/ja/api/wrapper/emittedByOrder.html">wrapper.emittedByOrder()</a> を呼び出すことで、発行順序のイベントの配列を取得することもできます。</p> <h3 id="コンポーネントの状態を操作する"><a href="#コンポーネントの状態を操作する" class="header-anchor">#</a> コンポーネントの状態を操作する</h3> <p>ラッパの <code>setData</code> メソッドまたは <code>setProps</code> メソッドを使って、コンポーネントの状態を直接操作することができます。:</p> <div class="language-js extra-class"><pre class="language-js"><code>wrapper<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

wrapper<span class="token punctuation">.</span><span class="token function">setProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token punctuation">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="プロパティをモックする"><a href="#プロパティをモックする" class="header-anchor">#</a> プロパティをモックする</h3> <p>Vue に組み込まれた <code>propsData</code> オプションを使用してコンポーネントにプロパティを渡すことができます:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>

<span class="token function">mount</span><span class="token punctuation">(</span>Component<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  propsData<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    aProp<span class="token punctuation">:</span> <span class="token string">'some value'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>wrapper.setProps({})</code> メソッドを使用して、すでにマウントされているコンポーネントのプロパティを更新することもできます。</p> <p><em>オプションの完全なリストについては、ドキュメントの<a href="/ja/api/options.html">マウントオプションのセクション</a>を参照してください。</em></p> <h3 id="グローバルプラグインとミックスインの適用"><a href="#グローバルプラグインとミックスインの適用" class="header-anchor">#</a> グローバルプラグインとミックスインの適用</h3> <p>コンポーネントの中には、グローバルプラグインやミックスインによって注入された機能 (例: <code>vuex</code>、<code>vue-router</code> など)に依存するものもあります。</p> <p>特定のアプリケーションでコンポーネントのテストを作成している場合は、同じグローバルプラグインとミックスインをテストのエントリに設定できます。しかし、異なるアプリケーション間で共有される可能性のあるジェネリックコンポーネントスイートをテストする場合など、グローバルな <code>Vue</code> コンストラクタを汚染することなく、より孤立した設定でコンポーネントをテストする方が良い場合もあります。<a href="/ja/api/createLocalVue.html">createLocalVue</a> メソッドを使用すると、次のことができます:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createLocalVue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>

<span class="token comment">// 拡張された Vue コンストラクタを作成する</span>
<span class="token keyword">const</span> localVue <span class="token operator">=</span> <span class="token function">createLocalVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// プラグインをインストールする</span>
localVue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>MyPlugin<span class="token punctuation">)</span>

<span class="token comment">// localVue をマウントオプションに渡す</span>
<span class="token function">mount</span><span class="token punctuation">(</span>Component<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  localVue
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>Vue Router のようなプラグインはグローバルの Vue コンストラクタに read-only なプロパティを追加します。<br>
これは localVue コンストラクタにそのプラグインを再びインストールすることや read-only なプロパティに対するモックを追加することを不可能にします。</strong></p> <h3 id="モックの注入"><a href="#モックの注入" class="header-anchor">#</a> モックの注入</h3> <p>単純なモックを注入するための別の戦略として <code>mocks</code> オプションで行うことができます:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>

<span class="token keyword">const</span> $route <span class="token operator">=</span> <span class="token punctuation">{</span>
  path<span class="token punctuation">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
  hash<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  params<span class="token punctuation">:</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token string">'123'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  query<span class="token punctuation">:</span> <span class="token punctuation">{</span> q<span class="token punctuation">:</span> <span class="token string">'hello'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">mount</span><span class="token punctuation">(</span>Component<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  mocks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    $route <span class="token comment">// コンポーネントをマウントする前に、モックした $route オブジェクトを Vue インスタンスに追加します。</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="スタブコンポーネント"><a href="#スタブコンポーネント" class="header-anchor">#</a> スタブコンポーネント</h3> <p><code>stubs</code> オプションを使用して、グローバルまたはローカルに登録されたコンポーネントを上書きできます:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>

<span class="token function">mount</span><span class="token punctuation">(</span>Component<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// globally-registered-component を空のスタブとして</span>
  <span class="token comment">// 解決します</span>
  stubs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'globally-registered-component'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="ルーティングの扱い"><a href="#ルーティングの扱い" class="header-anchor">#</a> ルーティングの扱い</h3> <p>定義によるルーティングは、アプリケーションの全体的な構造と関連し、複数のコンポーネントが関係するため、統合テストまたはエンドツーエンドテストによってよくテストされます。
<code>vue-router</code> 機能に依存する個々のコンポーネントについては、上記の手法を使ってモックすることができます。</p> <h3 id="キー、マウス、その他の-dom-イベントのテスト"><a href="#キー、マウス、その他の-dom-イベントのテスト" class="header-anchor">#</a> キー、マウス、その他の DOM イベントのテスト</h3> <h3 id="イベントをトリガする"><a href="#イベントをトリガする" class="header-anchor">#</a> イベントをトリガする</h3> <p><code>Wrapper</code> の <code>trigger</code> メソッドで DOM イベントをトリガすることができます。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>MyButton<span class="token punctuation">)</span>

wrapper<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
</code></pre></div><p><code>find</code> メソッドは <code>mount</code> メソッドと同じように <code>Wrapper</code> を返します。 <code>MyComponent</code> 内に <code>button</code> があると仮定すると、以下のコードは、 <code>button</code> をクリックします。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">)</span>

wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="オプション"><a href="#オプション" class="header-anchor">#</a> オプション</h3> <p><code>trigger</code> メソッドはオプションで <code>options</code> オブジェクトを引数として取ります。<code>options</code> オブジェクトのプロパティはイベントオブジェクトのプロパティに追加されます。</p> <p>target を <code>options</code> オブジェクトに追加することができないことに注意してください。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>MyButton<span class="token punctuation">)</span>

wrapper<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> button<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="マウスクリックの例"><a href="#マウスクリックの例" class="header-anchor">#</a> マウスクリックの例</h3> <p><strong>テスト対象のコンポーネント</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>yes<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>callYes<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Yes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>no<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>callNo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>No<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'YesNoComponent'</span><span class="token punctuation">,</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      callMe<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Function
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token function">callYes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callMe</span><span class="token punctuation">(</span><span class="token string">'yes'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">callNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callMe</span><span class="token punctuation">(</span><span class="token string">'no'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>テスト</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> YesNoComponent <span class="token keyword">from</span> <span class="token string">'@/components/YesNoComponent'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> sinon <span class="token keyword">from</span> <span class="token string">'sinon'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Click event'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Click on yes button calls our method with argument &quot;yes&quot;'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> spy <span class="token operator">=</span> sinon<span class="token punctuation">.</span><span class="token function">spy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>YesNoComponent<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      propsData<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        callMe<span class="token punctuation">:</span> spy
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button.yes'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>

    spy<span class="token punctuation">.</span>should<span class="token punctuation">.</span>have<span class="token punctuation">.</span>been<span class="token punctuation">.</span><span class="token function">calledWith</span><span class="token punctuation">(</span><span class="token string">'yes'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="キーボードの例"><a href="#キーボードの例" class="header-anchor">#</a> キーボードの例</h3> <p><strong>テスト対象のコンポーネント</strong></p> <p>このコンポーネントはいくつかのキーを使用して <code>quantity</code> を増減することができます。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@keydown.prevent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>onKeydown<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>quantity<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">const</span> <span class="token constant">KEY_DOWN</span> <span class="token operator">=</span> <span class="token number">40</span>
  <span class="token keyword">const</span> <span class="token constant">KEY_UP</span> <span class="token operator">=</span> <span class="token number">38</span>
  <span class="token keyword">const</span> <span class="token constant">ESCAPE</span> <span class="token operator">=</span> <span class="token number">27</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        quantity<span class="token punctuation">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>quantity <span class="token operator">+=</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>quantity <span class="token operator">-=</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>quantity <span class="token operator">=</span> <span class="token number">0</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">onKeydown</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>keyCode <span class="token operator">===</span> <span class="token constant">ESCAPE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>keyCode <span class="token operator">===</span> <span class="token constant">KEY_DOWN</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>keyCode <span class="token operator">===</span> <span class="token constant">KEY_UP</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>quantity <span class="token operator">=</span> <span class="token number">13</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">quantity</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>テスト</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> QuantityComponent <span class="token keyword">from</span> <span class="token string">'@/components/QuantityComponent'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Key event tests'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Quantity is zero by default'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>QuantityComponent<span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>quantity<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Cursor up sets quantity to 1'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>QuantityComponent<span class="token punctuation">)</span>
    wrapper<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'keydown.up'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>quantity<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Cursor down reduce quantity by 1'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>QuantityComponent<span class="token punctuation">)</span>
    wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>quantity <span class="token operator">=</span> <span class="token number">5</span>
    wrapper<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'keydown.down'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>quantity<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Escape sets quantity to 0'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>QuantityComponent<span class="token punctuation">)</span>
    wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>quantity <span class="token operator">=</span> <span class="token number">5</span>
    wrapper<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'keydown.esc'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>quantity<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Magic character &quot;a&quot; sets quantity to 13'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>QuantityComponent<span class="token punctuation">)</span>
    wrapper<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      key<span class="token punctuation">:</span> <span class="token string">'a'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>quantity<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>制限事項</strong></p> <p><code>.</code> の後のキー名( <code>keydown.up</code> の場合 <code>up</code> )は <code>keyCode</code> に変換されます。以下のキー名が変換されます。</p> <table><thead><tr><th>キー名</th> <th>キーコード</th></tr></thead> <tbody><tr><td>enter</td> <td>13</td></tr> <tr><td>esc</td> <td>27</td></tr> <tr><td>tab</td> <td>9</td></tr> <tr><td>space</td> <td>32</td></tr> <tr><td>delete</td> <td>46</td></tr> <tr><td>backspace</td> <td>8</td></tr> <tr><td>insert</td> <td>45</td></tr> <tr><td>up</td> <td>38</td></tr> <tr><td>down</td> <td>40</td></tr> <tr><td>left</td> <td>37</td></tr> <tr><td>right</td> <td>39</td></tr> <tr><td>end</td> <td>35</td></tr> <tr><td>home</td> <td>36</td></tr> <tr><td>pageup</td> <td>33</td></tr> <tr><td>pagedown</td> <td>34</td></tr></tbody></table> <h3 id="重要事項"><a href="#重要事項" class="header-anchor">#</a> 重要事項</h3> <p><code>vue-test-utils</code> は同期的にイベントをトリガします。従って、 <code>Vue.nextTick()</code> を実行する必要はありません。</p> <h2 id="テストランナを選ぶ"><a href="#テストランナを選ぶ" class="header-anchor">#</a> テストランナを選ぶ</h2> <p>テストランナは、テストを実行するプログラムです。</p> <p>多くの一般的な JavaScript テストランナがあり、<code>vue-test-utils</code> はそれらすべてで動作します。テストランナにとらわれません。</p> <p>ですが、テストランナを選択する際には、機能セット、パフォーマンス、および単一ファイルコンポーネント (SFC) の事前コンパイルのサポートなどを考慮すべきです。既存のライブラリを慎重に比較した上で、以下の 2 つのテストランナをお勧めします:</p> <ul><li><p><a href="https://jestjs.io/docs/en/getting-started.html#content" target="_blank" rel="noopener noreferrer">Jest<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> は最も充実したテストランナです。最小の設定が必要で、デフォルトで JSDOM を設定し、組み込みの検証を提供し、コマンドラインのユーザーエクスペリエンスが優れています。ただし、テストで SFC コンポーネントをインポートできるようにするには、プリプロセッサが必要です。最も一般的な SFC 機能を処理できる <code>vue-jest</code> プリプロセッサを作成しましたが、現在 <code>vue-loader</code> と 100% 同じ機能を持っていません。</p></li> <li><p><a href="https://github.com/zinserjan/mocha-webpack" target="_blank" rel="noopener noreferrer">mocha-webpack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> は webpack + Mocha のラッパですが、より合理的なインタフェースと watch モードを備えています。この設定のメリットは、webpack + <code>vue-loader</code> を使用して完全な SFC サポートを得ることができるということですが、より多くの設定を行う必要があります。</p></li></ul> <h3 id="ブラウザ環境"><a href="#ブラウザ環境" class="header-anchor">#</a> ブラウザ環境</h3> <p><code>vue-test-utils</code> はブラウザ環境に依存します。技術的には、実際のブラウザで実行することはできますが、異なるプラットフォーム上で実際のブラウザを起動するという複雑さのため、お勧めできません。代わりに、<a href="https://github.com/tmpvar/jsdom" target="_blank" rel="noopener noreferrer">JSDOM<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> を使用して仮想ブラウザ環境で Node.js でテストを実行することをお勧めします。</p> <p>Jest テストランナーは JSDOM を自動的に設定します。他のテストランナーの場合は、<a href="https://github.com/rstacruz/jsdom-global" target="_blank" rel="noopener noreferrer">jsdom-global<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> を使用してテスト用の JSDOM を手動で設定できます:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev jsdom jsdom-global
</code></pre></div><hr> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// テストのセットアップと登録</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsdom-global'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="単一ファイルコンポーネントをテストする"><a href="#単一ファイルコンポーネントをテストする" class="header-anchor">#</a> 単一ファイルコンポーネントをテストする</h3> <p>単一ファイルコンポーネントは、ノードまたはブラウザで実行する前に事前コンパイルが必要です。コンパイルを実行するには、Jest プリプロセッサを使用する方法と webpack を直接使用する方法が推奨されます。</p> <p><code>vue-jest</code> プリプロセッサは基本的な SFC 機能をサポートしていますが、現在 <code>vue-loader</code> でのみサポートされているスタイルブロックやカスタムブロックは扱いません。これらの機能やその他の Webpack 固有の設定に依存する場合は、webpack + <code>vue-loader</code> ベースの設定を使用する必要があります。</p> <p>さまざまな設定については、次のガイドをお読みください:</p> <ul><li><a href="/ja/guides/testing-single-file-components-with-jest.html">Jest による単一ファイルコンポーネントのテスト</a></li> <li><a href="/ja/guides/testing-single-file-components-with-mocha-webpack.html">Mocha + webpack による単一ファイルコンポーネントのテスト</a></li></ul> <h3 id="リソース"><a href="#リソース" class="header-anchor">#</a> リソース</h3> <ul><li><a href="https://github.com/eddyerburgh/vue-unit-test-perf-comparison" target="_blank" rel="noopener noreferrer">テストランナの性能比較<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/vuejs/vue-test-utils-jest-example" target="_blank" rel="noopener noreferrer">Jest のプロジェクト例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/vuejs/vue-test-utils-mocha-webpack-example" target="_blank" rel="noopener noreferrer">Mocha のプロジェクト例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/eddyerburgh/vue-test-utils-tape-example" target="_blank" rel="noopener noreferrer">tape のプロジェクト例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/eddyerburgh/vue-test-utils-ava-example" target="_blank" rel="noopener noreferrer">AVA のプロジェクト例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="jest-を使用した単一ファイルコンポーネントのテスト"><a href="#jest-を使用した単一ファイルコンポーネントのテスト" class="header-anchor">#</a> Jest を使用した単一ファイルコンポーネントのテスト</h2> <blockquote><p>このセットアップのサンプルプロジェクトは、 <a href="https://github.com/vuejs/vue-test-utils-jest-example" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> にあります。</p></blockquote> <p>Jest は Facebook が開発したテストランナであり、ユニットテストソリューションの提供を目指しています。 Jest の詳細については、<a href="https://jestjs.io/" target="_blank" rel="noopener noreferrer">公式ドキュメント<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>を参照してください。</p> <h3 id="jest-のセットアップ"><a href="#jest-のセットアップ" class="header-anchor">#</a> Jest のセットアップ</h3> <p>既に、webpack、vue-loader、および Babel が正しく設定されている設定から始めると仮定します。例: <code>vue-cli</code> によって雛形生成された <code>webpack-simple</code> テンプレートです。</p> <p>まず Jest と <code>vue-test-utils</code> をインストールします:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">install</span> --save-dev jest @vue/test-utils
</code></pre></div><p>次に、<code>package.json</code> にスクリプトを定義する必要があります。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="jest-における単一ファイルコンポーネントの処理"><a href="#jest-における単一ファイルコンポーネントの処理" class="header-anchor">#</a> Jest における単一ファイルコンポーネントの処理</h3> <p>Jest に <code>*.vue</code> ファイルの処理方法を教えるために、<code>vue-jest</code> プリプロセッサをインストールして設定する必要があります。：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev vue-jest
</code></pre></div><p>次に、<code>package.json</code> に <code>jest</code> ブロックを作成します:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;moduleFileExtensions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;js&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
      <span class="token comment">// *.vue ファイルを処理するように Jest に指示する</span>
      <span class="token string">&quot;vue&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;transform&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// vue-jest で *.vue ファイルを処理する</span>
      <span class="token property">&quot;.*\\.(vue)$&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-jest&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><strong>注意:</strong> <code>vue-jest</code> は現在、カスタムブロックのサポートやスタイルのロードなど、<code>vue-loader</code> のすべての機能をサポートしていません。さらに、コード分割などの Webpack 固有の機能はサポートされていません。サポートされていない機能を使用するには、 Jest の代わりに Mocha をテストランナーとして使用します。そして、 Webpack をコンポーネントをコンパイルするために使用します。やり方は <a href="/ja/guides/testing-single-file-components-with-mocha-webpack.html">Mocha + webpack による単一ファイルコンポーネントのテスト</a>のガイドをお読みください。</p></blockquote> <h3 id="webpack-エイリアスの処理"><a href="#webpack-エイリアスの処理" class="header-anchor">#</a> Webpack エイリアスの処理</h3> <p>webpack 設定で、<code>@</code> を <code>/src</code> のエイリアスにしたいといった場合、<code>moduleNameMapper</code>オプションを使って Jest の設定を追加する必要があります</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token comment">// ソースコードにある @ を src へと割当てる</span>
    <span class="token property">&quot;moduleNameMapper&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;^@/(.*)$&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&lt;rootDir&gt;/src/$1&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="jest-のための-babel-の設定"><a href="#jest-のための-babel-の設定" class="header-anchor">#</a> Jest のための Babel の設定</h3> <p>Node の最新バージョンではすでにほとんどの ES2015 機能がサポートされていますが、テストでは ES Modules 構文と stage-x 機能を使用することができます。そのために、<code>babel-jest</code> をインストールする必要があります。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev babel-jest
</code></pre></div><p>次に、Jest に <code>babel-jest</code> で JavaScript テストファイルを処理するよう、<code>package.json</code> の <code>jest.transform</code> の中にエントリを追加する必要があります:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token property">&quot;transform&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
      <span class="token comment">// babel-jest で js を処理する</span>
      <span class="token property">&quot;^.+\\.js$&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&lt;rootDir&gt;/node_modules/babel-jest&quot;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>デフォルトでは、<code>babel-jest</code> はインストールしさえすれば自動的に設定します。しかし、<code>*.vue</code> ファイルのための変換を明示的に追加したため、<code>babel-jest</code> も明示的に設定する必要があります。</p></blockquote> <p>webpack で <code>babel-preset-env</code> を使用するとした場合、webpack は ES Modules 処理方法を既に知っているので、デフォルトの Babel 設定は ES Modules のトランスパイルを無効にします。ただし、Jest テストは Node で直接実行されるため、テスト用に有効にする必要があります。</p> <p>また、<code>babel-preset-env</code> に、使用している Node のバージョンを指定するように指示することもできます。これにより不要な機能をスキップし、テストがより速く起動します。</p> <p>これらのオプションをテストのためだけに適用するには、 <code>env.test</code> の下に別の設定をします（これは <code>babel-jest</code> によって自動的に選択されます）。</p> <p>例 <code>.babelrc</code>:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;env&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token property">&quot;modules&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;env&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token property">&quot;targets&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;current&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="テストファイルの配置"><a href="#テストファイルの配置" class="header-anchor">#</a> テストファイルの配置</h3> <p>デフォルトでは、Jest はプロジェクト全体で <code>.spec.js</code> または <code>.test.js</code> 拡張子を持つすべてのファイルを再帰的に取得します。これがあなたのニーズに合わない場合は、<code>package.json</code> ファイルの config セクションで<a href="https://jestjs.io/docs/en/configuration.html#testregex-string-array-string" target="_blank" rel="noopener noreferrer">testRegex を変更する<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ことが可能です。</p> <p>Jest は、テスト対象のコードのすぐ隣に<code>__tests__</code>ディレクトリを作成することを推奨していますが、適切にテストを構造化することは自由です。 Jest がスナップショットテストを実行するテストファイルの隣に<code>__snapshots__</code>ディレクトリを作成することに注意してください。</p> <h3 id="カバレッジ"><a href="#カバレッジ" class="header-anchor">#</a> カバレッジ</h3> <p>Jest は複数のフォーマットでカバレッジを取ることができます。 以下はそれをするための簡単な例です。</p> <p><code>jest</code> の設定 (普通は <code>package.json</code> か  <code>jest.config.js</code>) に  <a href="https://jestjs.io/docs/en/configuration.html#collectcoverage-boolean" target="_blank" rel="noopener noreferrer">collectCoverage<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> オプションを加えます。それから、カバレッジを収集する対象のファイルを <a href="https://jestjs.io/docs/en/configuration.html#collectcoveragefrom-array" target="_blank" rel="noopener noreferrer">collectCoverageFrom<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> に配列で定義します。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token property">&quot;collectCoverage&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;collectCoverageFrom&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;**/*.{js,vue}&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;!**/node_modules/**&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a href="https://jestjs.io/docs/en/configuration.html#coveragereporters-array-string" target="_blank" rel="noopener noreferrer">デフォルトのカバレッジレポーター<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>のカバレッジレポートは有効になります。 <code>coverageReporters</code> オプションでそれらをカスタマイズすることができます。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token property">&quot;coverageReporters&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;html&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text-summary&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>より詳しい情報は <a href="https://jestjs.io/docs/en/configuration.html#collectcoverage-boolean" target="_blank" rel="noopener noreferrer">Jest configuration documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> にあります。 カバレッジの閾値やターゲットを出力するディレクトリなどのオプションが記載されています。</p> <h3 id="spec-の例"><a href="#spec-の例" class="header-anchor">#</a> Spec の例</h3> <p>あなたが Jasmine をよく知っているなら、Jest の <a href="https://jestjs.io/docs/en/expect.html#content" target="_blank" rel="noopener noreferrer">assertion API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>は自宅のように感じるはずです。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Component <span class="token keyword">from</span> <span class="token string">'./component'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Component'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'is a Vue instance'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>Component<span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">isVueInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="スナップショットテスト"><a href="#スナップショットテスト" class="header-anchor">#</a> スナップショットテスト</h3> <p>Vue Test Utils でコンポーネントをマウントすると、コンポーネントのルート HTML 要素にアクセスすることができます。 <a href="https://jestjs.io/docs/en/snapshot-testing.html" target="_blank" rel="noopener noreferrer">Jest のスナップショットテスト<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>で使用するためにこれを保存することができます。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'renders correctly'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>Component<span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>カスタムシリアライザを使用することによって保存されたスナップショットを改善することができます。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev jest-serializer-vue
</code></pre></div><p><code>package.json</code> でその設定をします。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token comment">// スナップショットに対するシリアライズ</span>
    <span class="token property">&quot;snapshotSerializers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;jest-serializer-vue&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="リソース-2"><a href="#リソース-2" class="header-anchor">#</a> リソース</h3> <ul><li><a href="https://github.com/vuejs/vue-test-utils-jest-example" target="_blank" rel="noopener noreferrer">このセットアップのプロジェクト例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/codebryo/vue-testing-with-jest-conf17" target="_blank" rel="noopener noreferrer">Vue Conf 2017 のスライド<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://jestjs.io/" target="_blank" rel="noopener noreferrer">Jest<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/babel/babel-preset-env" target="_blank" rel="noopener noreferrer">Babel preset env<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="mocha-webpack-による単一ファイルコンポーネントのテスト"><a href="#mocha-webpack-による単一ファイルコンポーネントのテスト" class="header-anchor">#</a> Mocha + webpack による単一ファイルコンポーネントのテスト</h3> <blockquote><p>このセットアップのサンプルプロジェクトは、 <a href="https://github.com/vuejs/vue-test-utils-mocha-webpack-example" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> にあります。</p></blockquote> <p>単一ファイルコンポーネントをテストするためのもう一つの戦略は、webpack を使用してすべてのテストをコンパイルし、それをテストランナで実行することです。このアプローチの利点は、すべての webpack と <code>vue-loader</code> 機能を完全にサポートしていることです。ソースコードに妥協する必要はありません。</p> <p>技術的に好きなテストランナを使用して結びつけることができますが、この特定の作業に非常に合理的な経験を提供するために <a href="https://github.com/zinserjan/mocha-webpack" target="_blank" rel="noopener noreferrer"><code>mocha-webpack</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> を見つけました。</p> <h3 id="mocha-webpack-の設定"><a href="#mocha-webpack-の設定" class="header-anchor">#</a> <code>mocha-webpack</code> の設定</h3> <p>既に、webpack、vue-loader、および Babel が正しく設定されている設定から始めると仮定します。例: <code>vue-cli</code> によって雛形生成された <code>webpack-simple</code> テンプレートです。</p> <p>最初に行うことは、テストの依存関係をインストールすることです:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev @vue/test-utils mocha mocha-webpack
</code></pre></div><p>次に、<code>package.json</code> にスクリプトを定義する必要があります。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mocha-webpack --webpack-config webpack.config.js --require test/setup.js test/**/*.spec.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ここで注意すべき点がいくつかあります:</p> <ul><li><p><code>--webpack-config</code> フラグはテストに使う webpack 設定ファイルを指定します。ほとんどの場合、これは実際のプロジェクトで使用する設定と同じですが、小さな調整が 1 つあります。これについては後で話します。</p></li> <li><p><code>--require</code> フラグは、テストの前に <code>test/setup.js</code> ファイルが実行されることを保証します。このテストでは、テストを実行するためのグローバル環境を設定できます。</p></li> <li><p>最後の引数は、テストバンドルに含まれるテストファイルのグロブです。</p></li></ul> <h3 id="別の-webpack-の設定"><a href="#別の-webpack-の設定" class="header-anchor">#</a> 別の webpack の設定</h3> <h4 id="npm-依存関係の外部化"><a href="#npm-依存関係の外部化" class="header-anchor">#</a> NPM 依存関係の外部化</h4> <p>私たちのテストでは、いくつかの NPM 依存関係をインポートする可能性があります。これらのモジュールの中には、ブラウザの使用を念頭に置いて記述されているものもあれば、webpack によって適切にバンドルされていないものもあります。依存関係を外部化することにより、テストの起動速度が大幅に向上するというもう一つの考慮すべき点としてあります。<code>webpack-node-externals</code> を使って NPM の依存関係をすべて外部化することができます:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
<span class="token keyword">const</span> nodeExternals <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-node-externals'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  externals<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token function">nodeExternals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="ソースマップ"><a href="#ソースマップ" class="header-anchor">#</a> ソースマップ</h4> <p>ソースマップは、<code>mocha-webpack</code> によってピックアップされるようにインライン化する必要があります。推奨設定は次のとおりです:</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  devtool<span class="token punctuation">:</span> <span class="token string">'inline-cheap-module-source-map'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>IDE 経由でデバッグする場合は、以下を追加することをお勧めします:</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token comment">// ソースマップで絶対パスを使用する（IDE 経由のデバッグで重要）</span>
    devtoolModuleFilenameTemplate<span class="token punctuation">:</span> <span class="token string">'[absolute-resource-path]'</span><span class="token punctuation">,</span>
    devtoolFallbackModuleFilenameTemplate<span class="token punctuation">:</span> <span class="token string">'[absolute-resource-path]?[hash]'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="ブラウザ環境の設定"><a href="#ブラウザ環境の設定" class="header-anchor">#</a> ブラウザ環境の設定</h3> <p><code>vue-test-utils</code> はブラウザ環境を必要とします。<code>jsdom-global</code>を 使って Node.js でシミュレーションすることができます:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev jsdom jsdom-global
</code></pre></div><p>次に、<code>test/setup.js</code> の中で:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsdom-global'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>これにより、node にブラウザ環境が追加され、 <code>vue-test-utils</code> が正しく動作するようになります。</p> <h3 id="検証ライブラリのピッキング"><a href="#検証ライブラリのピッキング" class="header-anchor">#</a> 検証ライブラリのピッキング</h3> <p><a href="http://chaijs.com/" target="_blank" rel="noopener noreferrer">Chai<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> は Mocha と並んで一般的に使用される一般的な検証ライブラリです。また、スパイとスタブを作成するための <a href="http://sinonjs.org/" target="_blank" rel="noopener noreferrer">Sinon<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> をチェックしてみてください。</p> <p>あるいは、Jest の一部である <code>expect</code> を使うことができ、Jest のドキュメントにある<a href="http://facebook.github.io/jest/docs/en/expect.html#content" target="_blank" rel="noopener noreferrer">まったく同じ API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>を公開しています。</p> <p>ここで <code>expect</code> を使用してグローバルに利用できるようにして、すべてのテストでインポートする必要はありません。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev <span class="token function">expect</span>
</code></pre></div><p>次に、<code>test/setup.js</code> の中で:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsdom-global'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

global<span class="token punctuation">.</span>expect <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'expect'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="テストのための-babel-の最適化"><a href="#テストのための-babel-の最適化" class="header-anchor">#</a> テストのための Babel の最適化</h3> <p>JavaScript を処理するには <code>babel-loader</code> を使用しています。<code>.babelrc</code> ファイルを使ってあなたのアプリでそれを使用しているならば、Babel を設定しておくべきです。<code>babel-loader</code> は自動的に同じ設定ファイルを使います。</p> <p>注意すべき点の 1 つは、Node バージョン 6 以降を使用している場合、ES2015 の大部分の機能を既にサポートしているため、使用している Node のバージョンではサポートされていない機能のみをトランスパイルする Babel の <a href="https://babeljs.io/docs/usage/babelrc/#env-option" target="_blank" rel="noopener noreferrer">env オプション<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>を設定できます。(例えば<code>stage-2</code>や flow 構文のサポートなど)</p> <h3 id="テストを追加する"><a href="#テストを追加する" class="header-anchor">#</a> テストを追加する</h3> <p><code>Counter.vue</code> という名前の <code>src</code> ファイルを作成します。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    {{ count }}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>increment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Increment<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        count<span class="token punctuation">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">++</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>次のコードを使って <code>test/Counter.spec.js</code> という名前のテストファイルを作成します。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">'../src/Counter.vue'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Counter.vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'increments count when button is clicked'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span>
    wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatch</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>これでテストを実行できます:</p> <div class="language- extra-class"><pre class="language-text"><code>npm run test
</code></pre></div><p>やったー！テストを実行している!</p> <h3 id="カバレッジ-2"><a href="#カバレッジ-2" class="header-anchor">#</a> カバレッジ</h3> <p>mocha-webpack にコードカバレッジをセットしたい場合は、 <a href="https://github.com/zinserjan/mocha-webpack/blob/master/docs/guides/code-coverage.md" target="_blank" rel="noopener noreferrer">the mocha-webpack code coverage guide<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> に従ってください。</p> <h3 id="リソース-3"><a href="#リソース-3" class="header-anchor">#</a> リソース</h3> <ul><li><a href="https://github.com/vuejs/vue-test-utils-mocha-webpack-example" target="_blank" rel="noopener noreferrer">この設定のプロジェクトの例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://mochajs.org/" target="_blank" rel="noopener noreferrer">Mocha<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://zinserjan.github.io/mocha-webpack/" target="_blank" rel="noopener noreferrer">mocha-webpack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://chaijs.com/" target="_blank" rel="noopener noreferrer">Chai<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://sinonjs.org/" target="_blank" rel="noopener noreferrer">Sinon<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://facebook.github.io/jest/docs/en/expect.html#content" target="_blank" rel="noopener noreferrer">jest/expect<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="karma-による単一ファイルコンポーネントのテスト"><a href="#karma-による単一ファイルコンポーネントのテスト" class="header-anchor">#</a> Karma による単一ファイルコンポーネントのテスト</h2> <blockquote><p>このセットアップの例は <a href="https://github.com/eddyerburgh/vue-test-utils-karma-example" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> にあり、利用可能です。</p></blockquote> <p>Karma はブラウザを起動し、テストを実行しそれをレポートするテストランナーです。ここではテストを書くために Mocha を使用します。テストアサーションのために Chai を使用します。</p> <h3 id="mocha-をセットアップする"><a href="#mocha-をセットアップする" class="header-anchor">#</a> Mocha をセットアップする</h3> <p>セットアップを始めるにあたって <code>vue-cli</code> でスキャフォールドされた <code>webpack-simple</code> テンプレートのように Webpack 、vue-loader 、 Babel が既に設定されていることを想定しています。</p> <p>最初にテストに必要なライブラリをインストールします。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev @vue/test-utils karma karma-chrome-launcher karma-mocha karma-sourcemap-loader karma-spec-reporter karma-webpack mocha
</code></pre></div><p>次に test スクリプトを <code>package.json</code> に定義します。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;karma start --single-run&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>--single-run</code> フラグは Karma にテストスウィートを 1 回実行するように指定します。</li></ul> <h3 id="karma-の設定"><a href="#karma-の設定" class="header-anchor">#</a> Karma の設定</h3> <p>プロジェクトディレクトリのトップに karma.conf.js ファイルを作成します。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// karma.conf.js</span>

<span class="token keyword">var</span> webpackConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.config.js'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  config<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    frameworks<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'mocha'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    files<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'test/**/*.spec.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    preprocessors<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">'**/*.spec.js'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'webpack'</span><span class="token punctuation">,</span> <span class="token string">'sourcemap'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    webpack<span class="token punctuation">:</span> webpackConfig<span class="token punctuation">,</span>

    reporters<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'spec'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    browsers<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'Chrome'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>このファイルは Karma を設定するために使用されます。</p> <p>ファイルを Webpack で前処理する必要があります。そのために、 Webpack をプリプロセッサとして加えます。そして、 Webpack の設定を含めます。プロジェクトに元々あった Webpack の設定ファイルを変更なしで使用することができます。</p> <p>この設定では、 Chrome でテストを実行します。他のブラウザを加える方法は <a href="http://karma-runner.github.io/3.0/config/browsers.html" target="_blank" rel="noopener noreferrer">Karma のドキュメントにあるブラウザセクション<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> を見てください。</p> <h3 id="アサーションライブラリを選ぶ"><a href="#アサーションライブラリを選ぶ" class="header-anchor">#</a> アサーションライブラリを選ぶ</h3> <p><a href="http://chaijs.com/" target="_blank" rel="noopener noreferrer">Chai<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> はよく Mocha と一緒に使用される人気のあるアサーションライブラリです。spy と stub を生成するために <a href="http://sinonjs.org/" target="_blank" rel="noopener noreferrer">Sinon<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> を見てみるとよいかもしれません。</p> <p>テストで <code>Chai</code> を使うために <code>karma-chai</code> プラグインをインストールします。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev karma-chai
</code></pre></div><h3 id="テストを加える"><a href="#テストを加える" class="header-anchor">#</a> テストを加える</h3> <p><code>Counter.vue</code> ファイルを  <code>src</code> ディレクトリに作成します。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    {{ count }}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>increment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Increment<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        count<span class="token punctuation">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">++</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>そして、以下のようなコードの <code>test/Counter.spec.js</code> という名前のテストファイルを作成します。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'chai'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">'../src/Counter.vue'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Counter.vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'increments count when button is clicked'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span>
    wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>テストを実行できるようになりました。</p> <div class="language- extra-class"><pre class="language-text"><code>npm run test
</code></pre></div><p>やった!テストが走った。</p> <h3 id="カバレッジ-3"><a href="#カバレッジ-3" class="header-anchor">#</a> カバレッジ</h3> <p>Karma にコードカバレッジをセットアップするために、 <code>karma-coverage</code> プラグインを使います。</p> <p>デフォルトでは、 <code>karma-coverage</code> はソースマップをカバレッジレポートをマップすることに使用しません。だから、確実に正しくカバレッジがマップされるために <code>babel-plugin-istanbul</code> を使用します。</p> <p><code>karma-coverage</code> と  <code>babel-plugin-istanbul</code> と  <code>cross-env</code> をインストールします。</p> <div class="language- extra-class"><pre class="language-text"><code>npm install --save-dev karma-coverage cross-env
</code></pre></div><p>環境変数の <code>BABEL_ENV</code> をセットするために <code>cross-env</code> を使います。テストをコンパイルする時に <code>babel-plugin-istanbul</code> を使用します。プロダクションコードをコンパイルする時は <code>babel-plugin-istnabul</code> を含めるべきではありません。</p> <div class="language- extra-class"><pre class="language-text"><code>npm install --save-dev babel-plugin-istanbul
</code></pre></div><p><code>BABEL_ENV</code> に test がセットされた時、 <code>babel-plugin-istanbul</code> を使用するために <code>.babelrc</code> ファイルを変更します。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;env&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token property">&quot;modules&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;stage-3&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;istanbul&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>カバレッジを取るために karma.conf.js ファイルを変更します。 <code>coverage</code> を reporters 配列に加えます。そして、 coverageReporter を加えます。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// karma.conf.js</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  config<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// ...</span>

    reporters<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'spec'</span><span class="token punctuation">,</span> <span class="token string">'coverage'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    coverageReporter<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      dir<span class="token punctuation">:</span> <span class="token string">'./coverage'</span><span class="token punctuation">,</span>
      reporters<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'lcov'</span><span class="token punctuation">,</span> subdir<span class="token punctuation">:</span> <span class="token string">'.'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'text-summary'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>そして、 <code>BABEL_ENV</code> をセットするために <code>test</code> スクリプトを変更します。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env BABEL_ENV=test karma start --single-run&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="リソース-4"><a href="#リソース-4" class="header-anchor">#</a> リソース</h3> <ul><li><a href="https://github.com/eddyerburgh/vue-test-utils-karma-example" target="_blank" rel="noopener noreferrer">このセットアップの例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://karma-runner.github.io/" target="_blank" rel="noopener noreferrer">Karma<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://mochajs.org/" target="_blank" rel="noopener noreferrer">Mocha<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://chaijs.com/" target="_blank" rel="noopener noreferrer">Chai<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://sinonjs.org/" target="_blank" rel="noopener noreferrer">Sinon<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="非同期動作のテスト"><a href="#非同期動作のテスト" class="header-anchor">#</a> 非同期動作のテスト</h2> <p>テストをシンプルにするために、 <code>vue-test-utils</code> は DOM の更新を同期的に適用します。しかし、コールバックや Promise のようなコンポーネントの非同期動作をテストする場合、いくつかのテクニックを知っておく必要があります。</p> <p>よくある非同期動作の 1 つとして API 呼び出しと Vuex の action があります。以下の例は API 呼び出しをするメソッドをテストする方法を示しています。この例は HTTP のライブラリである <code>axios</code> をモックしてテストを実行するために Jest を使っています。Jest のモックの詳細は<a href="https://jestjs.io/docs/en/manual-mocks.html#content" target="_blank" rel="noopener noreferrer">ここ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>にあります。</p> <p><code>axios</code> のモックの実装はこのようにします。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data<span class="token punctuation">:</span> <span class="token string">'value'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ボタンをクリックすると以下のコンポーネントは API 呼び出しをします。そして、レスポンスを <code>value</code> に代入します。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fetchResults<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        value<span class="token punctuation">:</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">async</span> <span class="token function">fetchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'mock/service'</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> response<span class="token punctuation">.</span>data
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>テストはこのように書くことができます。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Foo <span class="token keyword">from</span> <span class="token string">'./Foo'</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'fetches async when a button is clicked'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Foo<span class="token punctuation">)</span>
  wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>fetchResults</code> 内の Promise が resolve する前にアサーションが呼ばれるので、このテストは現時点では失敗します。ほとんどのユニットテストライブラリはテストが完了したことをテストランナーに知らせるためのコールバック関数を提供します。Jest と Mocha は両方とも  <code>done</code> を使います。アサーションが行われる前に確実に各 Promise が resolve するために <code>done</code> を <code>$nextTick</code> や  <code>setTimeout</code> と組み合わせて使うことができます。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'fetches async when a button is clicked'</span><span class="token punctuation">,</span> <span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Foo<span class="token punctuation">)</span>
  wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
  wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">)</span>
    <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>$nextTick</code> と  <code>setTimeout</code> がテストをパスする理由は <code>$nextTick</code> と  <code>setTimeout</code> を処理するタスクキュー前に Promise のコールバック関数を処理するマイクロタスクキューが実行されるからです。つまり、<code>$nextTick</code> と  <code>setTimeout</code> が実行される前に、マイクロタスクキュー上にあるすべての Promise のコールバック関数が実行されます。より詳しい説明は<a href="https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/" target="_blank" rel="noopener noreferrer">ここ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>を見てください。</p> <p>もう 1 つの解決策は <code>async</code> function と npm パッケージの <code>flush-promises</code> を使用することです。<code>flush-promises</code> は堰き止められている resolve された Promise ハンドラを流します。堰き止められている Promise を流すこととテストの可読性を改善するために <code>await</code> を <code>flushPromises</code> の呼び出しの前に置きます。</p> <p>反映されたテストはこのようになります。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> flushPromises <span class="token keyword">from</span> <span class="token string">'flush-promises'</span>
<span class="token keyword">import</span> Foo <span class="token keyword">from</span> <span class="token string">'./Foo'</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'fetches async when a button is clicked'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Foo<span class="token punctuation">)</span>
  wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">flushPromises</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>同じテクニックをデフォルトで Promise を返す Vuex の action に適用することができます。</p> <h2 id="typescript-と一緒に使う"><a href="#typescript-と一緒に使う" class="header-anchor">#</a> TypeScript と一緒に使う</h2> <blockquote><p>この記事のサンプルプロジェクトは、 <a href="https://github.com/vuejs/vue-test-utils-typescript-example" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> にあります。</p></blockquote> <p>TypeScript は JavaScript に型とクラスを加えた人気のある JavaScript のスーパーセットです。 Vue Test Utils の型定義は、配布されている Vue Test Utils のパッケージに含まれています。だから、Vue Test Utils と TypeScript はうまく動作します。</p> <p>ここでは、基本的な Vue CLI を使った TypeScript のセットアップから Jest と Vue Test Utils を使用した TypeScript のテストの作成までを解説します。</p> <h3 id="typescript-の追加"><a href="#typescript-の追加" class="header-anchor">#</a> TypeScript の追加</h3> <p>最初にプロジェクトを作成します。もし、Vue CLI をインストールしていないなら、 Vue CLI をグローバルにインストールしてください。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">npm</span> <span class="token function">install</span> -g @vue/cli
</code></pre></div><p>以下のようにプロジェクトを作成します。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ vue create hello-world
</code></pre></div><p>CLI プロンプトで <code>Manually select features</code> を選択します。そして、 TypeScript を選択して Enter キーを押します。これで TypeScript の設定がされているプロジェクトが生成されます。</p> <div class="tip custom-block"><p class="custom-block-title">注意</p> <p>Vue と TypeScript を一緒に使うためのセットアップの詳細は、 <a href="https://github.com/Microsoft/TypeScript-Vue-Starter" target="_blank" rel="noopener noreferrer">TypeScript Vue starter guide<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> を確認してください。</p></div> <p>次にプロジェクトに Jest を加えます。</p> <h3 id="jest-のセットアップ-2"><a href="#jest-のセットアップ-2" class="header-anchor">#</a> Jest のセットアップ</h3> <p>Jest はバッテリー付属のユニットテストソリューションを提供するために Facebook が開発したテストランナです。 Jest の詳細については<a href="https://jestjs.io/" target="_blank" rel="noopener noreferrer">公式ドキュメント<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> を参照してください。</p> <p>Jest と Vue Test Utils をインストールします。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">install</span> --save-dev jest @vue/test-utils
</code></pre></div><p>次に <code>test:unit</code> スクリプトを <code>package.json</code> に定義します。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
  <span class="token comment">// ..</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ..</span>
    <span class="token property">&quot;test:unit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest&quot;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ..</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="jest-での単一ファイルコンポーネントの処理"><a href="#jest-での単一ファイルコンポーネントの処理" class="header-anchor">#</a> Jest での単一ファイルコンポーネントの処理</h3> <p>Jest が <code>*.vue</code> ファイルを処理するために <code>vue-jest</code> プリプロセッサをインストールして設定します。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev vue-jest
</code></pre></div><p>次に <code>jest</code> ブロックを <code>package.json</code> に追加します。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;moduleFileExtensions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;js&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;ts&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
      <span class="token comment">// `*.vue` ファイルを Jest で取り扱います。</span>
      <span class="token string">&quot;vue&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;transform&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// `vue-jest` で　`*.vue` ファイルを処理します。</span>
      <span class="token property">&quot;.*\\.(vue)$&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-jest&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;testURL&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost/&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="jest-に対応するための-typescript-の設定"><a href="#jest-に対応するための-typescript-の設定" class="header-anchor">#</a> Jest に対応するための TypeScript の設定</h3> <p>テストで TypeScript ファイルを使うために Jest が TypeScript をコンパイルするようにセットアップする必要があります。そのために <code>ts-jest</code> をインストールします。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">install</span> --save-dev ts-jest
</code></pre></div><p>次に Jest が TypeScript のテストファイルを <code>ts-jest</code> で処理するために <code>package.json</code> の <code>jest.transform</code> に設定を追加します。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token property">&quot;transform&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
      <span class="token comment">// `ts-jest` で `*.ts` ファイルを処理します。</span>
      <span class="token property">&quot;^.+\\.tsx?$&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ts-jest&quot;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="テストファイルの配置-2"><a href="#テストファイルの配置-2" class="header-anchor">#</a> テストファイルの配置</h3> <p>デフォルトでは、 Jest はプロジェクトにある拡張子が <code>.spec.js</code> もしくは <code>.test.js</code> のすべてのファイルを対象にします。</p> <p>拡張子が <code>.ts</code> のテストファイルを実行するために、<code>package.json</code> ファイルの <code>testRegex</code> を変更する必要があります。</p> <p>以下を <code>package.json</code> の <code>jest</code> フィールドに追加します。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token property">&quot;testRegex&quot;</span><span class="token operator">:</span> <span class="token string">&quot;(/__tests__/.*|(\\.|/)(test|spec))\\.(jsx?|tsx?)$&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Jest はテストされるコードと同じディレクトリに <code>__tests__</code> ディレクトリを作成することを推奨していますが、あなたにとってテストに適したディレクトリ構造にして構いません。ただ、Jest は <code>__snapshots__</code> ディレクトリをスナップショットテストを実施するテストファイルと同じディレクトリに作成することに注意してください。</p> <h3 id="ユニットテストを書く"><a href="#ユニットテストを書く" class="header-anchor">#</a> ユニットテストを書く</h3> <p>これでプロジェクトのセットアップが完了しました。今度はユニットテストを作成します。</p> <p><code>src/components/__tests__/HelloWorld.spec.ts</code> ファイルを作成して、以下のコードを加えます。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/components/__tests__/HelloWorld.spec.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> HelloWorld <span class="token keyword">from</span> <span class="token string">'../HelloWorld.vue'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'HelloWorld.vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'renders props.msg when passed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token string">'new message'</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>HelloWorld<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      propsData<span class="token punctuation">:</span> <span class="token punctuation">{</span> msg <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatch</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>これが TypeScript と Vue Test Utils を協業させるために必要なことすべてです!</p> <h3 id="リソース-5"><a href="#リソース-5" class="header-anchor">#</a> リソース</h3> <ul><li><a href="https://github.com/vuejs/vue-test-utils-typescript-example" target="_blank" rel="noopener noreferrer">この記事のサンプルプロジェクト<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://jestjs.io/" target="_blank" rel="noopener noreferrer">Jest<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="vue-router-と一緒に使用する"><a href="#vue-router-と一緒に使用する" class="header-anchor">#</a> Vue Router と一緒に使用する</h3> <h3 id="テストへ-vue-router-のインストール"><a href="#テストへ-vue-router-のインストール" class="header-anchor">#</a> テストへ Vue Router のインストール</h3> <p>テストで Vue のコンストラクタベースの Vue Router をインストールしないでください。Vue Router をインストールすると Vue のプロトタイプの読み取り専用プロパティとして <code>$route</code> と <code>$router</code> が追加されます。</p> <p>これを回避するために、localeVue を作成し、その上に Vue Router をインストールすることができます。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount<span class="token punctuation">,</span> createLocalVue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">'vue-router'</span>

<span class="token keyword">const</span> localVue <span class="token operator">=</span> <span class="token function">createLocalVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
localVue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueRouter<span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">shallowMount</span><span class="token punctuation">(</span>Component<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  localVue<span class="token punctuation">,</span>
  router
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>Vue Router を localVue にインストールすると <code>$route</code> と  <code>$router</code> が読み取り専用プロパティーとして localVue に追加されます。これは VueRouter をインストールした localVue を使用しているコンポーネントをマウントする時、 <code>mock</code> オプションで <code>$route</code> と  <code>$router</code> を上書きすることができないことを意味します。</p></blockquote> <h3 id="router-link-または-router-view-を使用するコンポーネントテスト"><a href="#router-link-または-router-view-を使用するコンポーネントテスト" class="header-anchor">#</a> <code>router-link</code> または <code>router-view</code> を使用するコンポーネントテスト</h3> <p>Vue Router をインストールする時、<code>router-link</code> と <code>router-view</code> コンポーネントが登録されます。これは、それらをアプリケーションにインポートする必要がなく、アプリケーションのどこでも使用することができます。</p> <p>テストを実行する際には、マウントしているコンポーネントにこれら Vue Router のコンポーネントを使用できるようにする必要があります。これらを行うには 2 つの方法があります。</p> <h3 id="スタブを使用する"><a href="#スタブを使用する" class="header-anchor">#</a> スタブを使用する</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>

<span class="token function">shallowMount</span><span class="token punctuation">(</span>Component<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  stubs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'router-link'</span><span class="token punctuation">,</span> <span class="token string">'router-view'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="localvue-による-vue-router-のインストール"><a href="#localvue-による-vue-router-のインストール" class="header-anchor">#</a> localVue による Vue Router のインストール</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount<span class="token punctuation">,</span> createLocalVue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">'vue-router'</span>

<span class="token keyword">const</span> localVue <span class="token operator">=</span> <span class="token function">createLocalVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
localVue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueRouter<span class="token punctuation">)</span>

<span class="token function">shallowMount</span><span class="token punctuation">(</span>Component<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  localVue
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="route-と-router-のモック"><a href="#route-と-router-のモック" class="header-anchor">#</a> <code>$route</code> と <code>$router</code> のモック</h3> <p>時々、コンポーネントが <code>$route</code> と <code>$router</code> オブジェクトから引数によって何かをするテストをしたいときがあります。これをするためには、Vue インスタンスにカスタムモックを渡すことができます。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>

<span class="token keyword">const</span> $route <span class="token operator">=</span> <span class="token punctuation">{</span>
  path<span class="token punctuation">:</span> <span class="token string">'/some/path'</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Component<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  mocks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    $route
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$route<span class="token punctuation">.</span>path <span class="token comment">// /some/path</span>
</code></pre></div><h3 id="よくある落とし穴"><a href="#よくある落とし穴" class="header-anchor">#</a> よくある落とし穴</h3> <p>Vue Router をインストールすると Vue のプロトタイプに読み取り専用プロパティとして <code>$route</code> と <code>$router</code> が追加されます。</p> <p>これは、<code>$route</code> または <code>$router</code> をモックを試みるテストが将来失敗することを意味します。</p> <p>これを回避するために、テストを実行するときに、Vue Router をグローバルにインストールしないでください。<br>
上記のように localVue を使用してください。</p> <h1 id="vuex-と一緒に使用する"><a href="#vuex-と一緒に使用する" class="header-anchor">#</a> Vuex と一緒に使用する</h1> <p>このガイドでは、<code>vue-test-utils</code> でコンポーネントで Vuex をテストする方法について、見ていきます。</p> <h2 id="コンポーネント内の-vuex-をテストする"><a href="#コンポーネント内の-vuex-をテストする" class="header-anchor">#</a> コンポーネント内の Vuex をテストする</h2> <h3 id="アクションのモック"><a href="#アクションのモック" class="header-anchor">#</a> アクションのモック</h3> <p>それではいくつかのコードを見ていきましょう。</p> <p>これはテストしたいコンポーネントです。これは Vuex のアクションを呼び出します。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text-align-center<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>actionInputIfTrue<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>actionClick()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Click<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> mapActions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'actionClick'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function-variable function">actionInputIfTrue</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token function">actionInputIfTrue</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> inputValue <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
        <span class="token keyword">if</span> <span class="token punctuation">(</span>inputValue <span class="token operator">===</span> <span class="token string">'input'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'actionInput'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> inputValue <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>このテストの目的のために、アクションが何をしているのか、またはストアがどのように見えるかは気にしません。これらのアクションが必要なときに発行されていること、そして期待された値によって発行されていることを知ることが必要です。</p> <p>これをテストするためには、私たちのコンポーネントを shallowMount するときに Vue にモックストアを渡す必要があります。</p> <p>ストアを Vue コンストラクタベースに渡す代わりに、<a href="/ja/api/options.html#localvue">localVue</a> に渡すことができます。localeVue はグローバルな Vue コンストラクタに影響を与えずに、変更を加えることができるスコープ付き Vue コンストラクタです。</p> <p>これがどのように見えるか見ていきましょう:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount<span class="token punctuation">,</span> createLocalVue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>
<span class="token keyword">import</span> Actions <span class="token keyword">from</span> <span class="token string">'../../../src/components/Actions'</span>

<span class="token keyword">const</span> localVue <span class="token operator">=</span> <span class="token function">createLocalVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

localVue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Actions.vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> actions
  <span class="token keyword">let</span> store

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    actions <span class="token operator">=</span> <span class="token punctuation">{</span>
      actionClick<span class="token punctuation">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      actionInput<span class="token punctuation">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      state<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      actions
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'dispatches &quot;actionInput&quot; when input event value is &quot;input&quot;'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Actions<span class="token punctuation">,</span> <span class="token punctuation">{</span> store<span class="token punctuation">,</span> localVue <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> input <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span>
    input<span class="token punctuation">.</span>element<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'input'</span>
    input<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span>actionInput<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'does not dispatch &quot;actionInput&quot; when event value is not &quot;input&quot;'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Actions<span class="token punctuation">,</span> <span class="token punctuation">{</span> store<span class="token punctuation">,</span> localVue <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> input <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span>
    input<span class="token punctuation">.</span>element<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'not input'</span>
    input<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span>actionInput<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'calls store action actionClick when button is clicked'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Actions<span class="token punctuation">,</span> <span class="token punctuation">{</span> store<span class="token punctuation">,</span> localVue <span class="token punctuation">}</span><span class="token punctuation">)</span>
    wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span>actionClick<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>ここでは何が起こっているでしょうか？まず、Vue に <code>localVue.use</code> メソッドを使用して Vuex を使用するように指示しています。これは、単なる <code>Vue.use</code> のラッパです。</p> <p>次に、新しい <code>Vuex.store</code> をモックした値で呼び出すことによってモックのストアを作成します。それをアクションに渡すだけです。それが気にしなければならないことの全てだからです。</p> <p>アクションは、<a href="https://jestjs.io/docs/en/mock-functions.html" target="_blank" rel="noopener noreferrer">Jest のモック関数<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>です。これらモック関数は、アクションが呼び出されたかどうかを検証するメソッドを提供します。</p> <p>アクションのスタブが期待どおりに呼び出されたことを検証することができます。</p> <p>今、ストアを定義する方法が、あなたには少し異質に見えるかもしれません。</p> <p>各テストより前にストアをクリーンに保証するために、<code>beforeEach</code> を使用しています。<code>beforeEach</code> は各テストより前に呼び出される Mocha のフックです。このテストでは、ストア変数に値を再度割り当てています。これをしていない場合は、モック関数は自動的にリセットされる必要があります。また、テストにおいて状態を変更することもできますが、この方法は、後のテストで影響を与えることはないです。</p> <p>このテストで最も重要なことは、<strong>モック Vuex ストアを作成し、それを vue-test-utils に渡す</strong> ことです。</p> <p>素晴らしい！今、アクションをモック化できるので、ゲッタのモックについて見ていきましょう。</p> <h3 id="ゲッタのモック"><a href="#ゲッタのモック" class="header-anchor">#</a> ゲッタのモック</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>inputValue<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{inputValue}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>clicks<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{clicks}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> mapGetters <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    computed<span class="token punctuation">:</span> <span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'clicks'</span><span class="token punctuation">,</span> <span class="token string">'inputValue'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>これは、かなり単純なコンポーネントです。ゲッタによる <code>clicks</code> の結果と <code>inputValue</code> を描画します。また、これらゲッタが返す値については実際に気にしません。それらの結果が正しく描画されているかだけです。</p> <p>テストを見てみましょう:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount<span class="token punctuation">,</span> createLocalVue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>
<span class="token keyword">import</span> Getters <span class="token keyword">from</span> <span class="token string">'../../../src/components/Getters'</span>

<span class="token keyword">const</span> localVue <span class="token operator">=</span> <span class="token function">createLocalVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

localVue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Getters.vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> getters
  <span class="token keyword">let</span> store

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    getters <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">clicks</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token function-variable function">inputValue</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">'input'</span>
    <span class="token punctuation">}</span>

    store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      getters
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Renders state.inputValue in first p tag'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Getters<span class="token punctuation">,</span> <span class="token punctuation">{</span> store<span class="token punctuation">,</span> localVue <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> p <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>getters<span class="token punctuation">.</span><span class="token function">inputValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Renders state.clicks in second p tag'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Getters<span class="token punctuation">,</span> <span class="token punctuation">{</span> store<span class="token punctuation">,</span> localVue <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> p <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>getters<span class="token punctuation">.</span><span class="token function">clicks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>このテストはアクションのテストに似ています。各テストの前にモックストアを作成し、<code>shallowMount</code> を呼び出すときにオプションを渡し、そしてモックゲッタから返された値を描画されているのを検証します。</p> <p>これは素晴らしいですが、もしゲッタが状態の正しい部分を返しているのを確認したい場合はどうしますか？</p> <h3 id="モジュールによるモック"><a href="#モジュールによるモック" class="header-anchor">#</a> モジュールによるモック</h3> <p><a href="https://vuex.vuejs.org/ja/guide/modules.html" target="_blank" rel="noopener noreferrer">モジュール<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>はストアを管理しやすい塊に分けるために便利です。それらはゲッタもエクスポートします。テストではこれらを使用することができます。</p> <p>コンポーネントを見てみましょう:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>moduleActionClick()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Click<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{moduleClicks}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> mapActions<span class="token punctuation">,</span> mapGetters <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'moduleActionClick'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    computed<span class="token punctuation">:</span> <span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'moduleClicks'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>1 つのアクションと 1 つのゲッタを含む単純なコンポーネントです。</p> <p>そしてテストは以下のようになります:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount<span class="token punctuation">,</span> createLocalVue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>
<span class="token keyword">import</span> MyComponent <span class="token keyword">from</span> <span class="token string">'../../../src/components/MyComponent'</span>
<span class="token keyword">import</span> myModule <span class="token keyword">from</span> <span class="token string">'../../../src/store/myModule'</span>

<span class="token keyword">const</span> localVue <span class="token operator">=</span> <span class="token function">createLocalVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

localVue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'MyComponent.vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> actions
  <span class="token keyword">let</span> state
  <span class="token keyword">let</span> store

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state <span class="token operator">=</span> <span class="token punctuation">{</span>
      clicks<span class="token punctuation">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>

    actions <span class="token operator">=</span> <span class="token punctuation">{</span>
      moduleActionClick<span class="token punctuation">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      modules<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        myModule<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          state<span class="token punctuation">,</span>
          actions<span class="token punctuation">,</span>
          getters<span class="token punctuation">:</span> myModule<span class="token punctuation">.</span>getters
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'calls store action &quot;moduleActionClick&quot; when button is clicked'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">,</span> <span class="token punctuation">{</span> store<span class="token punctuation">,</span> localVue <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> button <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span>
    button<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span>moduleActionClick<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'renders &quot;state.inputValue&quot; in first p tag'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">,</span> <span class="token punctuation">{</span> store<span class="token punctuation">,</span> localVue <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> p <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>clicks<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="vuex-ストアのテスト"><a href="#vuex-ストアのテスト" class="header-anchor">#</a> Vuex ストアのテスト</h3> <p>Vuex ストアをテストする方法が 2 つあります。1 つ目はゲッタとミューテーションとアクションを別々に単体テストする方法です。2 つ目はストアを生成してそれをテストする方法です。</p> <p>Vuex ストアをテストする方法を説明するためにシンプルなカウンターストアを用意します。このストアには <code>increment</code> ミューテーションと <code>evenOrOdd</code> ゲッタがあります。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// mutations.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">increment</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>count<span class="token operator">++</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// getters.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">evenOrOdd</span><span class="token punctuation">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>count <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">'even'</span> <span class="token punctuation">:</span> <span class="token string">'odd'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="ゲッタとミューテーションとアクションを別々にテストする"><a href="#ゲッタとミューテーションとアクションを別々にテストする" class="header-anchor">#</a> ゲッタとミューテーションとアクションを別々にテストする</h3> <p>ゲッタとミューテーションとアクションはすべて JavaScript の関数です。それらは <code>vue-test-utils</code> と Vuex を使用しなくてもテストすることができます。</p> <p>ゲッタとミューテーションとアクションを別々にテストする利点は単体テストを詳細に記述することができることです。テストが失敗すると、コードの何が原因か正確に知ることができます。欠点は <code>commit</code> や  <code>dispatch</code> のような Vuex の関数のモックが必要なことです。これは不正なモックが原因で単体テストはパスしてプロダクションは失敗する状況を作り出す可能性があります。</p> <p>mutations.spec.js と getters.spec.js という名前のテストファイルを 2 つ作成します。</p> <p>最初に increment ミューテーションをテストします。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// mutations.spec.js</span>

<span class="token keyword">import</span> mutations <span class="token keyword">from</span> <span class="token string">'./mutations'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'increment increments state.count by 1'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
    count<span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
  mutations<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>今度は <code>evenOrOdd</code> ゲッタを次の手順でテストします。 <code>state</code> モックを作成します。 <code>state</code> を引数としてゲッタ関数を実行します。そして、それが正しい値を返したか確認します。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// getters.spec.js</span>

<span class="token keyword">import</span> getters <span class="token keyword">from</span> <span class="token string">'./getters'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'evenOrOdd returns even if state.count is even'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
    count<span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token punctuation">}</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>getters<span class="token punctuation">.</span><span class="token function">evenOrOdd</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'even'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'evenOrOdd returns odd if state.count is odd'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
    count<span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>getters<span class="token punctuation">.</span><span class="token function">evenOrOdd</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'odd'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="実行可能なストアのテスト"><a href="#実行可能なストアのテスト" class="header-anchor">#</a> 実行可能なストアのテスト</h3> <p>Vuex ストアをテストするもう 1 つの方法はストアの設定を使って実行可能なストアを生成することです。</p> <p>実行可能なストアを生成してテストすることの利点は Vuex の関数をモックする必要がない事です。</p> <p>欠点はテストが失敗した時、問題がある箇所を見つけることが難しいことです。</p> <p>テストを書いてみましょう。ストアを生成する際は、 Vue のコンストラクタが汚染されることを避けるために <code>localVue</code> を使用します。このテストは store-config.js の export を使用してストアを生成します。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// store-config.js</span>

<span class="token keyword">import</span> mutations <span class="token keyword">from</span> <span class="token string">'./mutations'</span>
<span class="token keyword">import</span> getters <span class="token keyword">from</span> <span class="token string">'./getters'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    count<span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mutations<span class="token punctuation">,</span>
  getters
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createLocalVue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>
<span class="token keyword">import</span> storeConfig <span class="token keyword">from</span> <span class="token string">'./store-config'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> cloneDeep <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lodash'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'increments count value when increment is commited'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> localVue <span class="token operator">=</span> <span class="token function">createLocalVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  localVue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>
  <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token function">cloneDeep</span><span class="token punctuation">(</span>storeConfig<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'updates evenOrOdd getter when increment is commited'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> localVue <span class="token operator">=</span> <span class="token function">createLocalVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  localVue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>
  <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token function">cloneDeep</span><span class="token punctuation">(</span>storeConfig<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>evenOrOdd<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'even'</span><span class="token punctuation">)</span>
  store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>evenOrOdd<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'odd'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>ストアをストアの設定から生成する前に <code>cloneDeep</code> を使用しています。こうする理由は Vuex はストアを生成するためにオプションオブジェクトを変更するからです。どのテストでも確実に汚染されていないストアを使うために <code>storeConfig</code> オブジェクトを複製する必要があります。</p> <h3 id="リソース-6"><a href="#リソース-6" class="header-anchor">#</a> リソース</h3> <ul><li><a href="https://github.com/eddyerburgh/vue-test-utils-vuex-example" target="_blank" rel="noopener noreferrer">コンポーネントをテストする例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/eddyerburgh/testing-vuex-store-example" target="_blank" rel="noopener noreferrer">ストアをテストする例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="/ja/api/options.html#localvue">localVue</a></li> <li><a href="/ja/api/createLocalVue.html">createLocalVue</a></li></ul></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/vuejs/vue-test-utils/edit/dev/docs/ja/guides/README.md" target="_blank" rel="noopener noreferrer">GitHub 上でこのページを編集する</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/ja/" class="prev router-link-active">
          vue-test-utils
        </a></span> <span class="next"><a href="/ja/api/">
          API
        </a>
        →
      </span></p></div> <div class="bsa-cpc-wrapper"><div class="bsa-cpc"></div></div></div> <!----></div></div>
    <script src="/assets/js/app.1329aa21.js" defer></script><script src="/assets/js/124.8058bc12.js" defer></script>
  </body>
</html>
